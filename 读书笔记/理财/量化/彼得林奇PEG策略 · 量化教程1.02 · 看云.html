<!DOCTYPE html>
<!-- saved from url=(0061)https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318055 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
<title>彼得林奇PEG策略 · 量化教程1.02 · 看云</title>
    <meta name="description" content="增加了科创板医药医疗策略">
    <meta name="keywords" content="文档托管,文档管理,在线创作,文档在线管理,企业知识管理,知识库管理,在线知识管理,文档托管平台,电子出版,在线写书,文档在线转换,在线编辑,在线阅读,个人出版,知识付费,gitbook,开发手册,api手册,在线学习,文档编辑">
            <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" data-react-helmet="true">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
                                
<style>.spantree-toggler {
  position: fixed;
  padding: 4px 8px;
  top: 40%;
  transform: rotate(-90deg);
  transform-origin: top left;
  border-radius: 0px 0px 4px 4px;
  cursor: pointer;
  z-index: 10;
  box-shadow: 0px 0px 5px #000000d9;
  color: white;
  background: rgb(77, 61, 146);
}

/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL2NvbnRlbnQvc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Ub2dnbGVyL3N0eWxlcy5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxlQUFlO0VBQ2YsZ0JBQWdCO0VBQ2hCLFFBQVE7RUFDUix5QkFBeUI7RUFDekIsMEJBQTBCO0VBQzFCLDhCQUE4QjtFQUM5QixlQUFlO0VBQ2YsV0FBVztFQUNYLGlDQUFpQztFQUNqQyxZQUFZO0VBQ1osNEJBQTRCO0FBQzlCIiwic291cmNlc0NvbnRlbnQiOlsiLnNwYW50cmVlLXRvZ2dsZXIge1xuICBwb3NpdGlvbjogZml4ZWQ7XG4gIHBhZGRpbmc6IDRweCA4cHg7XG4gIHRvcDogNDAlO1xuICB0cmFuc2Zvcm06IHJvdGF0ZSgtOTBkZWcpO1xuICB0cmFuc2Zvcm0tb3JpZ2luOiB0b3AgbGVmdDtcbiAgYm9yZGVyLXJhZGl1czogMHB4IDBweCA0cHggNHB4O1xuICBjdXJzb3I6IHBvaW50ZXI7XG4gIHotaW5kZXg6IDEwO1xuICBib3gtc2hhZG93OiAwcHggMHB4IDVweCAjMDAwMDAwZDk7XG4gIGNvbG9yOiB3aGl0ZTtcbiAgYmFja2dyb3VuZDogcmdiKDc3LCA2MSwgMTQ2KTtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0= */</style><style>.spantree-loader {
  border-color: #f3f3f3;
  border-radius: 50%;
  border-style: solid;
  border-top-color: rgb(237, 153, 44);
  -webkit-animation: spantree-loader-spin 2s linear infinite; /* Safari */
  animation: spantree-loader-spin 2s linear infinite;
}

/* Safari */
@-webkit-keyframes spantree-loader-spin {
  0% {
    -webkit-transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
  }
}

@keyframes spantree-loader-spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL2NvbnRlbnQvc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Mb2FkZXIvc3R5bGVzLmNzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLHFCQUFxQjtFQUNyQixrQkFBa0I7RUFDbEIsbUJBQW1CO0VBQ25CLG1DQUFtQztFQUNuQywwREFBMEQsRUFBRSxXQUFXO0VBQ3ZFLGtEQUFrRDtBQUNwRDs7QUFFQSxXQUFXO0FBQ1g7RUFDRTtJQUNFLCtCQUErQjtFQUNqQztFQUNBO0lBQ0UsaUNBQWlDO0VBQ25DO0FBQ0Y7O0FBRUE7RUFDRTtJQUNFLHVCQUF1QjtFQUN6QjtFQUNBO0lBQ0UseUJBQXlCO0VBQzNCO0FBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIuc3BhbnRyZWUtbG9hZGVyIHtcbiAgYm9yZGVyLWNvbG9yOiAjZjNmM2YzO1xuICBib3JkZXItcmFkaXVzOiA1MCU7XG4gIGJvcmRlci1zdHlsZTogc29saWQ7XG4gIGJvcmRlci10b3AtY29sb3I6IHJnYigyMzcsIDE1MywgNDQpO1xuICAtd2Via2l0LWFuaW1hdGlvbjogc3BhbnRyZWUtbG9hZGVyLXNwaW4gMnMgbGluZWFyIGluZmluaXRlOyAvKiBTYWZhcmkgKi9cbiAgYW5pbWF0aW9uOiBzcGFudHJlZS1sb2FkZXItc3BpbiAycyBsaW5lYXIgaW5maW5pdGU7XG59XG5cbi8qIFNhZmFyaSAqL1xuQC13ZWJraXQta2V5ZnJhbWVzIHNwYW50cmVlLWxvYWRlci1zcGluIHtcbiAgMCUge1xuICAgIC13ZWJraXQtdHJhbnNmb3JtOiByb3RhdGUoMGRlZyk7XG4gIH1cbiAgMTAwJSB7XG4gICAgLXdlYmtpdC10cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpO1xuICB9XG59XG5cbkBrZXlmcmFtZXMgc3BhbnRyZWUtbG9hZGVyLXNwaW4ge1xuICAwJSB7XG4gICAgdHJhbnNmb3JtOiByb3RhdGUoMGRlZyk7XG4gIH1cbiAgMTAwJSB7XG4gICAgdHJhbnNmb3JtOiByb3RhdGUoMzYwZGVnKTtcbiAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ== */</style><style>.spantree-tree-element {
  padding: 2px 15px 2px 0px;
  display: flex;
  height: 24px;
  align-items: center;
  width: max-content;
}

.spantree-child-list {
  list-style-type: none;
  padding: 0px 0px 0px 20px;
}

.spantree-tree-icon {
  width: 16px;
  text-align: center;
  margin-right: 2px;
  padding-bottom: 2px;
}

.spantree-file-icon {
  width: 22px;
  text-align: left;
}

.spantree-file-icon i {
  font-style: normal;
}

.spantree-item-name {
  width: max-content;
}

.spantree-arrow {
  font-style: normal;
}

.spantree-full-width-row {
  position: absolute;
  height: 24px;
  width: 100%;
  left: 0px;
  z-index: 5;
  opacity: 25%;
  background: transparent;
  transition: 0.2s background;
  box-sizing: border-box;
}

.spantree-full-width-row:hover {
  background: #6464ff;
  cursor: pointer;
}

.spantree-full-width-row:active {
  background: blue;
}

.spantree-active-row {
  border: 3px solid black;
  background: darkslategrey;
}

/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL2NvbnRlbnQvc3JjL3NjcmlwdHMvY29tcG9uZW50cy9UcmVlSXRlbS9zdHlsZXMuY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0UseUJBQXlCO0VBQ3pCLGFBQWE7RUFDYixZQUFZO0VBQ1osbUJBQW1CO0VBQ25CLGtCQUFrQjtBQUNwQjs7QUFFQTtFQUNFLHFCQUFxQjtFQUNyQix5QkFBeUI7QUFDM0I7O0FBRUE7RUFDRSxXQUFXO0VBQ1gsa0JBQWtCO0VBQ2xCLGlCQUFpQjtFQUNqQixtQkFBbUI7QUFDckI7O0FBRUE7RUFDRSxXQUFXO0VBQ1gsZ0JBQWdCO0FBQ2xCOztBQUVBO0VBQ0Usa0JBQWtCO0FBQ3BCOztBQUVBO0VBQ0Usa0JBQWtCO0FBQ3BCOztBQUVBO0VBQ0Usa0JBQWtCO0FBQ3BCOztBQUVBO0VBQ0Usa0JBQWtCO0VBQ2xCLFlBQVk7RUFDWixXQUFXO0VBQ1gsU0FBUztFQUNULFVBQVU7RUFDVixZQUFZO0VBQ1osdUJBQXVCO0VBQ3ZCLDJCQUEyQjtFQUMzQixzQkFBc0I7QUFDeEI7O0FBRUE7RUFDRSxtQkFBbUI7RUFDbkIsZUFBZTtBQUNqQjs7QUFFQTtFQUNFLGdCQUFnQjtBQUNsQjs7QUFFQTtFQUNFLHVCQUF1QjtFQUN2Qix5QkFBeUI7QUFDM0IiLCJzb3VyY2VzQ29udGVudCI6WyIuc3BhbnRyZWUtdHJlZS1lbGVtZW50IHtcbiAgcGFkZGluZzogMnB4IDE1cHggMnB4IDBweDtcbiAgZGlzcGxheTogZmxleDtcbiAgaGVpZ2h0OiAyNHB4O1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICB3aWR0aDogbWF4LWNvbnRlbnQ7XG59XG5cbi5zcGFudHJlZS1jaGlsZC1saXN0IHtcbiAgbGlzdC1zdHlsZS10eXBlOiBub25lO1xuICBwYWRkaW5nOiAwcHggMHB4IDBweCAyMHB4O1xufVxuXG4uc3BhbnRyZWUtdHJlZS1pY29uIHtcbiAgd2lkdGg6IDE2cHg7XG4gIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgbWFyZ2luLXJpZ2h0OiAycHg7XG4gIHBhZGRpbmctYm90dG9tOiAycHg7XG59XG5cbi5zcGFudHJlZS1maWxlLWljb24ge1xuICB3aWR0aDogMjJweDtcbiAgdGV4dC1hbGlnbjogbGVmdDtcbn1cblxuLnNwYW50cmVlLWZpbGUtaWNvbiBpIHtcbiAgZm9udC1zdHlsZTogbm9ybWFsO1xufVxuXG4uc3BhbnRyZWUtaXRlbS1uYW1lIHtcbiAgd2lkdGg6IG1heC1jb250ZW50O1xufVxuXG4uc3BhbnRyZWUtYXJyb3cge1xuICBmb250LXN0eWxlOiBub3JtYWw7XG59XG5cbi5zcGFudHJlZS1mdWxsLXdpZHRoLXJvdyB7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgaGVpZ2h0OiAyNHB4O1xuICB3aWR0aDogMTAwJTtcbiAgbGVmdDogMHB4O1xuICB6LWluZGV4OiA1O1xuICBvcGFjaXR5OiAyNSU7XG4gIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50O1xuICB0cmFuc2l0aW9uOiAwLjJzIGJhY2tncm91bmQ7XG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG59XG5cbi5zcGFudHJlZS1mdWxsLXdpZHRoLXJvdzpob3ZlciB7XG4gIGJhY2tncm91bmQ6ICM2NDY0ZmY7XG4gIGN1cnNvcjogcG9pbnRlcjtcbn1cblxuLnNwYW50cmVlLWZ1bGwtd2lkdGgtcm93OmFjdGl2ZSB7XG4gIGJhY2tncm91bmQ6IGJsdWU7XG59XG5cbi5zcGFudHJlZS1hY3RpdmUtcm93IHtcbiAgYm9yZGVyOiAzcHggc29saWQgYmxhY2s7XG4gIGJhY2tncm91bmQ6IGRhcmtzbGF0ZWdyZXk7XG59XG4iXSwic291cmNlUm9vdCI6IiJ9 */</style><style>.spantree-loader-wrapper {
  height: 100%;
  display: flex;
  justify-content: center;
  align-content: center;
  align-items: center;
}

.spantree-tree-list {
  scroll-behavior: smooth;
  overflow-y: auto;
  height: calc(100vh - 40px);
}

.spantree-tree-list::-webkit-scrollbar-track {
  background-color: #c9c9c9;
}

.spantree-tree-list::-webkit-scrollbar-corner {
  background-color: #c9c9c9;
}

.spantree-tree-list::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.spantree-tree-list::-webkit-scrollbar-thumb {
  border-radius: 10px;
  -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
  background-color: rgba(0, 0, 0, 0.5);
}

.spantree-parent-list {
  font-size: 0.875rem;
  padding: 0px 0px 0px 5px;
  list-style-type: none;
  width: max-content;
  min-width: 100%;
  position: relative;
}

/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL2NvbnRlbnQvc3JjL3NjcmlwdHMvY29udGFpbmVycy9UcmVlTGlzdC9zdHlsZXMuY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0UsWUFBWTtFQUNaLGFBQWE7RUFDYix1QkFBdUI7RUFDdkIscUJBQXFCO0VBQ3JCLG1CQUFtQjtBQUNyQjs7QUFFQTtFQUNFLHVCQUF1QjtFQUN2QixnQkFBZ0I7RUFDaEIsMEJBQTBCO0FBQzVCOztBQUVBO0VBQ0UseUJBQXlCO0FBQzNCOztBQUVBO0VBQ0UseUJBQXlCO0FBQzNCOztBQUVBO0VBQ0UsVUFBVTtFQUNWLFdBQVc7QUFDYjs7QUFFQTtFQUNFLG1CQUFtQjtFQUNuQixvREFBb0Q7RUFDcEQsb0NBQW9DO0FBQ3RDOztBQUVBO0VBQ0UsbUJBQW1CO0VBQ25CLHdCQUF3QjtFQUN4QixxQkFBcUI7RUFDckIsa0JBQWtCO0VBQ2xCLGVBQWU7RUFDZixrQkFBa0I7QUFDcEIiLCJzb3VyY2VzQ29udGVudCI6WyIuc3BhbnRyZWUtbG9hZGVyLXdyYXBwZXIge1xuICBoZWlnaHQ6IDEwMCU7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICBhbGlnbi1jb250ZW50OiBjZW50ZXI7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG59XG5cbi5zcGFudHJlZS10cmVlLWxpc3Qge1xuICBzY3JvbGwtYmVoYXZpb3I6IHNtb290aDtcbiAgb3ZlcmZsb3cteTogYXV0bztcbiAgaGVpZ2h0OiBjYWxjKDEwMHZoIC0gNDBweCk7XG59XG5cbi5zcGFudHJlZS10cmVlLWxpc3Q6Oi13ZWJraXQtc2Nyb2xsYmFyLXRyYWNrIHtcbiAgYmFja2dyb3VuZC1jb2xvcjogI2M5YzljOTtcbn1cblxuLnNwYW50cmVlLXRyZWUtbGlzdDo6LXdlYmtpdC1zY3JvbGxiYXItY29ybmVyIHtcbiAgYmFja2dyb3VuZC1jb2xvcjogI2M5YzljOTtcbn1cblxuLnNwYW50cmVlLXRyZWUtbGlzdDo6LXdlYmtpdC1zY3JvbGxiYXIge1xuICB3aWR0aDogOHB4O1xuICBoZWlnaHQ6IDhweDtcbn1cblxuLnNwYW50cmVlLXRyZWUtbGlzdDo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWIge1xuICBib3JkZXItcmFkaXVzOiAxMHB4O1xuICAtd2Via2l0LWJveC1zaGFkb3c6IGluc2V0IDAgMCA2cHggcmdiYSgwLCAwLCAwLCAwLjMpO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuNSk7XG59XG5cbi5zcGFudHJlZS1wYXJlbnQtbGlzdCB7XG4gIGZvbnQtc2l6ZTogMC44NzVyZW07XG4gIHBhZGRpbmc6IDBweCAwcHggMHB4IDVweDtcbiAgbGlzdC1zdHlsZS10eXBlOiBub25lO1xuICB3aWR0aDogbWF4LWNvbnRlbnQ7XG4gIG1pbi13aWR0aDogMTAwJTtcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ== */</style><style>.spantree-resizer {
  /*background: red;*/
  width: 8px;
  position: relative;
  opacity: 100%;
}

.spantree-resizer:hover {
  cursor: col-resize;
}

/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL2NvbnRlbnQvc3JjL3NjcmlwdHMvY29udGFpbmVycy9SZXNpemVyL3N0eWxlcy5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxtQkFBbUI7RUFDbkIsVUFBVTtFQUNWLGtCQUFrQjtFQUNsQixhQUFhO0FBQ2Y7O0FBRUE7RUFDRSxrQkFBa0I7QUFDcEIiLCJzb3VyY2VzQ29udGVudCI6WyIuc3BhbnRyZWUtcmVzaXplciB7XG4gIC8qYmFja2dyb3VuZDogcmVkOyovXG4gIHdpZHRoOiA4cHg7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgb3BhY2l0eTogMTAwJTtcbn1cblxuLnNwYW50cmVlLXJlc2l6ZXI6aG92ZXIge1xuICBjdXJzb3I6IGNvbC1yZXNpemU7XG59XG4iXSwic291cmNlUm9vdCI6IiJ9 */</style><style>.spantree-tree-pane {
  position: fixed;
  display: flex;
  box-sizing: border-box;
  height: 100%;
  right: 0px !important;
  top: 0px !important;
  bottom: 0px !important;
  left: 0px !important;
  font-size: 0.8em;
  z-index: 1000;
  transform: translate3d(0px, 0px, 0px);
  transition: transform 0.2s ease 0s;
  box-shadow: 2px 0px 8px #00000070;
}

.spantree-pane-main {
  height: 100%;
  width: 100%;
  position: absolute;
}

.spantree-pane-header {
  height: 40px;
  background-color: rgb(77, 61, 146);
  border-bottom: 1px #404040 solid;
  color: white;
  padding: 5px;
  display: flex;
  flex-direction: column;
  justify-content: space-around;
}

.spantree-close-button {
  cursor: pointer;
  margin: 0 4px;
}

.spantree-spread {
  display: flex;
  justify-content: space-between;
}

.spantree-tree-body {
  height: 100%;
  width: 100%;
}

.spantree-pane-details {
  display: inline-block;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  font-weight: bold;
}

.spantree-pane-icons {
  min-width: 35px;
}

/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL2NvbnRlbnQvc3JjL3NjcmlwdHMvY29tcG9uZW50cy9QYW5lL3N0eWxlcy5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxlQUFlO0VBQ2YsYUFBYTtFQUNiLHNCQUFzQjtFQUN0QixZQUFZO0VBQ1oscUJBQXFCO0VBQ3JCLG1CQUFtQjtFQUNuQixzQkFBc0I7RUFDdEIsb0JBQW9CO0VBQ3BCLGdCQUFnQjtFQUNoQixhQUFhO0VBQ2IscUNBQXFDO0VBQ3JDLGtDQUFrQztFQUNsQyxpQ0FBaUM7QUFDbkM7O0FBRUE7RUFDRSxZQUFZO0VBQ1osV0FBVztFQUNYLGtCQUFrQjtBQUNwQjs7QUFFQTtFQUNFLFlBQVk7RUFDWixrQ0FBa0M7RUFDbEMsZ0NBQWdDO0VBQ2hDLFlBQVk7RUFDWixZQUFZO0VBQ1osYUFBYTtFQUNiLHNCQUFzQjtFQUN0Qiw2QkFBNkI7QUFDL0I7O0FBRUE7RUFDRSxlQUFlO0VBQ2YsYUFBYTtBQUNmOztBQUVBO0VBQ0UsYUFBYTtFQUNiLDhCQUE4QjtBQUNoQzs7QUFFQTtFQUNFLFlBQVk7RUFDWixXQUFXO0FBQ2I7O0FBRUE7RUFDRSxxQkFBcUI7RUFDckIsZ0JBQWdCO0VBQ2hCLG1CQUFtQjtFQUNuQix1QkFBdUI7RUFDdkIsaUJBQWlCO0FBQ25COztBQUVBO0VBQ0UsZUFBZTtBQUNqQiIsInNvdXJjZXNDb250ZW50IjpbIi5zcGFudHJlZS10cmVlLXBhbmUge1xuICBwb3NpdGlvbjogZml4ZWQ7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIGhlaWdodDogMTAwJTtcbiAgcmlnaHQ6IDBweCAhaW1wb3J0YW50O1xuICB0b3A6IDBweCAhaW1wb3J0YW50O1xuICBib3R0b206IDBweCAhaW1wb3J0YW50O1xuICBsZWZ0OiAwcHggIWltcG9ydGFudDtcbiAgZm9udC1zaXplOiAwLjhlbTtcbiAgei1pbmRleDogMTAwMDtcbiAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwcHgsIDBweCwgMHB4KTtcbiAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDAuMnMgZWFzZSAwcztcbiAgYm94LXNoYWRvdzogMnB4IDBweCA4cHggIzAwMDAwMDcwO1xufVxuXG4uc3BhbnRyZWUtcGFuZS1tYWluIHtcbiAgaGVpZ2h0OiAxMDAlO1xuICB3aWR0aDogMTAwJTtcbiAgcG9zaXRpb246IGFic29sdXRlO1xufVxuXG4uc3BhbnRyZWUtcGFuZS1oZWFkZXIge1xuICBoZWlnaHQ6IDQwcHg7XG4gIGJhY2tncm91bmQtY29sb3I6IHJnYig3NywgNjEsIDE0Nik7XG4gIGJvcmRlci1ib3R0b206IDFweCAjNDA0MDQwIHNvbGlkO1xuICBjb2xvcjogd2hpdGU7XG4gIHBhZGRpbmc6IDVweDtcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1hcm91bmQ7XG59XG5cbi5zcGFudHJlZS1jbG9zZS1idXR0b24ge1xuICBjdXJzb3I6IHBvaW50ZXI7XG4gIG1hcmdpbjogMCA0cHg7XG59XG5cbi5zcGFudHJlZS1zcHJlYWQge1xuICBkaXNwbGF5OiBmbGV4O1xuICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47XG59XG5cbi5zcGFudHJlZS10cmVlLWJvZHkge1xuICBoZWlnaHQ6IDEwMCU7XG4gIHdpZHRoOiAxMDAlO1xufVxuXG4uc3BhbnRyZWUtcGFuZS1kZXRhaWxzIHtcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICBvdmVyZmxvdzogaGlkZGVuO1xuICB3aGl0ZS1zcGFjZTogbm93cmFwO1xuICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpcztcbiAgZm9udC13ZWlnaHQ6IGJvbGQ7XG59XG5cbi5zcGFudHJlZS1wYW5lLWljb25zIHtcbiAgbWluLXdpZHRoOiAzNXB4O1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ== */</style><style>.spantree-backdrop {
  width: 100%;
  height: 100%;
  position: fixed;
  z-index: 5000;
  left: 0;
  top: 0;
  background-color: rgba(0, 0, 0, 0.3);
}

/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL2NvbnRlbnQvc3JjL3NjcmlwdHMvY29tcG9uZW50cy9CYWNrZHJvcC9zdHlsZXMuY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0UsV0FBVztFQUNYLFlBQVk7RUFDWixlQUFlO0VBQ2YsYUFBYTtFQUNiLE9BQU87RUFDUCxNQUFNO0VBQ04sb0NBQW9DO0FBQ3RDIiwic291cmNlc0NvbnRlbnQiOlsiLnNwYW50cmVlLWJhY2tkcm9wIHtcbiAgd2lkdGg6IDEwMCU7XG4gIGhlaWdodDogMTAwJTtcbiAgcG9zaXRpb246IGZpeGVkO1xuICB6LWluZGV4OiA1MDAwO1xuICBsZWZ0OiAwO1xuICB0b3A6IDA7XG4gIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC4zKTtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0= */</style><style>.spantree-search {
  position: fixed;
  z-index: 6000;
  background-color: white;
  min-width: 40%;
  border: 1px solid #ccc;
  box-shadow: 0px 0px 10px #00000040;
  left: 30%;
  top: 12%;
  box-sizing: border-box;
  border-radius: 3px;
  transition: all 0.3s ease-out;
}

.spantree-searchbar {
  padding: 10px;
}

.spantree-searchbar input {
  width: 100%;
  padding: 8px;
  border: 1px solid #bbbbbb;
  box-sizing: border-box;
}

.spantree-searchbar input:focus {
  border: 1px solid rgb(77, 61, 146);
  outline: none;
  box-shadow: 0px 0px 10px rgba(77, 61, 146, 0.25);
}

.spantree-search-results {
  overflow-y: scroll;
  overflow-x: hidden;
  max-height: 35vh;
}

.spantree-results-loading {
  color: grey;
}

.spantree-search-result {
  overflow-x: auto;
  padding: 5px 15px;
}

.spantree-search-result:hover {
  cursor: pointer;
}

.spantree-result-active {
  background: rgba(211, 211, 211, 0.5);
}

.spantree-search-result::-webkit-scrollbar {
  height: 0px;
}

.spantree-search-file {
  display: flex;
  font-size: 15px;
}

.spantree-search-filename {
  font-weight: 600;
  padding-left: 2px;
}

.spantree-search-filelocation {
  color: #919191;
  padding-left: 23px;
}

.spantree-in-fzy {
  color: rgb(77, 61, 146);
  font-weight: bold;
}

.spantree-search-term {
  margin-right: 10px;
}

.spantree-search-help {
  padding: 3px 8px 6px 8px;
  border-top: 1px solid #dddddd;
  font-size: 14px;
}

.spantree-search-help code {
  padding: 4px 6px;
}

.spantree-search-help-item {
  padding-right: 16px;
}

.spantree-search-help-item-icon {
  position: relative;
  font-size: 18px;
  top: 2px;
}

/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL2NvbnRlbnQvc3JjL3NjcmlwdHMvY29udGFpbmVycy9TZWFyY2hCYXIvc3R5bGVzLmNzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGVBQWU7RUFDZixhQUFhO0VBQ2IsdUJBQXVCO0VBQ3ZCLGNBQWM7RUFDZCxzQkFBc0I7RUFDdEIsa0NBQWtDO0VBQ2xDLFNBQVM7RUFDVCxRQUFRO0VBQ1Isc0JBQXNCO0VBQ3RCLGtCQUFrQjtFQUNsQiw2QkFBNkI7QUFDL0I7O0FBRUE7RUFDRSxhQUFhO0FBQ2Y7O0FBRUE7RUFDRSxXQUFXO0VBQ1gsWUFBWTtFQUNaLHlCQUF5QjtFQUN6QixzQkFBc0I7QUFDeEI7O0FBRUE7RUFDRSxrQ0FBa0M7RUFDbEMsYUFBYTtFQUNiLGdEQUFnRDtBQUNsRDs7QUFFQTtFQUNFLGtCQUFrQjtFQUNsQixrQkFBa0I7RUFDbEIsZ0JBQWdCO0FBQ2xCOztBQUVBO0VBQ0UsV0FBVztBQUNiOztBQUVBO0VBQ0UsZ0JBQWdCO0VBQ2hCLGlCQUFpQjtBQUNuQjs7QUFFQTtFQUNFLGVBQWU7QUFDakI7O0FBRUE7RUFDRSxvQ0FBb0M7QUFDdEM7O0FBRUE7RUFDRSxXQUFXO0FBQ2I7O0FBRUE7RUFDRSxhQUFhO0VBQ2IsZUFBZTtBQUNqQjs7QUFFQTtFQUNFLGdCQUFnQjtFQUNoQixpQkFBaUI7QUFDbkI7O0FBRUE7RUFDRSxjQUFjO0VBQ2Qsa0JBQWtCO0FBQ3BCOztBQUVBO0VBQ0UsdUJBQXVCO0VBQ3ZCLGlCQUFpQjtBQUNuQjs7QUFFQTtFQUNFLGtCQUFrQjtBQUNwQjs7QUFFQTtFQUNFLHdCQUF3QjtFQUN4Qiw2QkFBNkI7RUFDN0IsZUFBZTtBQUNqQjs7QUFFQTtFQUNFLGdCQUFnQjtBQUNsQjs7QUFFQTtFQUNFLG1CQUFtQjtBQUNyQjs7QUFFQTtFQUNFLGtCQUFrQjtFQUNsQixlQUFlO0VBQ2YsUUFBUTtBQUNWIiwic291cmNlc0NvbnRlbnQiOlsiLnNwYW50cmVlLXNlYXJjaCB7XG4gIHBvc2l0aW9uOiBmaXhlZDtcbiAgei1pbmRleDogNjAwMDtcbiAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7XG4gIG1pbi13aWR0aDogNDAlO1xuICBib3JkZXI6IDFweCBzb2xpZCAjY2NjO1xuICBib3gtc2hhZG93OiAwcHggMHB4IDEwcHggIzAwMDAwMDQwO1xuICBsZWZ0OiAzMCU7XG4gIHRvcDogMTIlO1xuICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICBib3JkZXItcmFkaXVzOiAzcHg7XG4gIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2Utb3V0O1xufVxuXG4uc3BhbnRyZWUtc2VhcmNoYmFyIHtcbiAgcGFkZGluZzogMTBweDtcbn1cblxuLnNwYW50cmVlLXNlYXJjaGJhciBpbnB1dCB7XG4gIHdpZHRoOiAxMDAlO1xuICBwYWRkaW5nOiA4cHg7XG4gIGJvcmRlcjogMXB4IHNvbGlkICNiYmJiYmI7XG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG59XG5cbi5zcGFudHJlZS1zZWFyY2hiYXIgaW5wdXQ6Zm9jdXMge1xuICBib3JkZXI6IDFweCBzb2xpZCByZ2IoNzcsIDYxLCAxNDYpO1xuICBvdXRsaW5lOiBub25lO1xuICBib3gtc2hhZG93OiAwcHggMHB4IDEwcHggcmdiYSg3NywgNjEsIDE0NiwgMC4yNSk7XG59XG5cbi5zcGFudHJlZS1zZWFyY2gtcmVzdWx0cyB7XG4gIG92ZXJmbG93LXk6IHNjcm9sbDtcbiAgb3ZlcmZsb3cteDogaGlkZGVuO1xuICBtYXgtaGVpZ2h0OiAzNXZoO1xufVxuXG4uc3BhbnRyZWUtcmVzdWx0cy1sb2FkaW5nIHtcbiAgY29sb3I6IGdyZXk7XG59XG5cbi5zcGFudHJlZS1zZWFyY2gtcmVzdWx0IHtcbiAgb3ZlcmZsb3cteDogYXV0bztcbiAgcGFkZGluZzogNXB4IDE1cHg7XG59XG5cbi5zcGFudHJlZS1zZWFyY2gtcmVzdWx0OmhvdmVyIHtcbiAgY3Vyc29yOiBwb2ludGVyO1xufVxuXG4uc3BhbnRyZWUtcmVzdWx0LWFjdGl2ZSB7XG4gIGJhY2tncm91bmQ6IHJnYmEoMjExLCAyMTEsIDIxMSwgMC41KTtcbn1cblxuLnNwYW50cmVlLXNlYXJjaC1yZXN1bHQ6Oi13ZWJraXQtc2Nyb2xsYmFyIHtcbiAgaGVpZ2h0OiAwcHg7XG59XG5cbi5zcGFudHJlZS1zZWFyY2gtZmlsZSB7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZvbnQtc2l6ZTogMTVweDtcbn1cblxuLnNwYW50cmVlLXNlYXJjaC1maWxlbmFtZSB7XG4gIGZvbnQtd2VpZ2h0OiA2MDA7XG4gIHBhZGRpbmctbGVmdDogMnB4O1xufVxuXG4uc3BhbnRyZWUtc2VhcmNoLWZpbGVsb2NhdGlvbiB7XG4gIGNvbG9yOiAjOTE5MTkxO1xuICBwYWRkaW5nLWxlZnQ6IDIzcHg7XG59XG5cbi5zcGFudHJlZS1pbi1menkge1xuICBjb2xvcjogcmdiKDc3LCA2MSwgMTQ2KTtcbiAgZm9udC13ZWlnaHQ6IGJvbGQ7XG59XG5cbi5zcGFudHJlZS1zZWFyY2gtdGVybSB7XG4gIG1hcmdpbi1yaWdodDogMTBweDtcbn1cblxuLnNwYW50cmVlLXNlYXJjaC1oZWxwIHtcbiAgcGFkZGluZzogM3B4IDhweCA2cHggOHB4O1xuICBib3JkZXItdG9wOiAxcHggc29saWQgI2RkZGRkZDtcbiAgZm9udC1zaXplOiAxNHB4O1xufVxuXG4uc3BhbnRyZWUtc2VhcmNoLWhlbHAgY29kZSB7XG4gIHBhZGRpbmc6IDRweCA2cHg7XG59XG5cbi5zcGFudHJlZS1zZWFyY2gtaGVscC1pdGVtIHtcbiAgcGFkZGluZy1yaWdodDogMTZweDtcbn1cblxuLnNwYW50cmVlLXNlYXJjaC1oZWxwLWl0ZW0taWNvbiB7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgZm9udC1zaXplOiAxOHB4O1xuICB0b3A6IDJweDtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0= */</style><style>
/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */</style><script src="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/index.js" async="" data-plugin-name="highlight"></script><script src="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/index(1).js" async="" data-plugin-name="tex"></script><script src="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/index(2).js" async="" data-plugin-name="theme-default"></script><link rel="stylesheet" href="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/style.css"><style type="text/css" data-react-helmet="true">.ಠhighlight-container code[class*=language-],.ಠhighlight-container pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}.ಠhighlight-container code[class*=language-]::-moz-selection,.ಠhighlight-container code[class*=language-] ::-moz-selection,.ಠhighlight-container pre[class*=language-]::-moz-selection,.ಠhighlight-container pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}.ಠhighlight-container code[class*=language-]::selection,.ಠhighlight-container code[class*=language-] ::selection,.ಠhighlight-container pre[class*=language-]::selection,.ಠhighlight-container pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{.ಠhighlight-container code[class*=language-],.ಠhighlight-container pre[class*=language-]{text-shadow:none}}.ಠhighlight-container pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}.ಠhighlight-container :not(pre)>code[class*=language-],.ಠhighlight-container pre[class*=language-]{background:#f5f2f0}.ಠhighlight-container :not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.ಠhighlight-container .token.cdata,.ಠhighlight-container .token.comment,.ಠhighlight-container .token.doctype,.ಠhighlight-container .token.prolog{color:#708090}.ಠhighlight-container .token.punctuation{color:#999}.ಠhighlight-container .namespace{opacity:.7}.ಠhighlight-container .token.boolean,.ಠhighlight-container .token.constant,.ಠhighlight-container .token.deleted,.ಠhighlight-container .token.number,.ಠhighlight-container .token.property,.ಠhighlight-container .token.symbol,.ಠhighlight-container .token.tag{color:#905}.ಠhighlight-container .token.attr-name,.ಠhighlight-container .token.builtin,.ಠhighlight-container .token.char,.ಠhighlight-container .token.inserted,.ಠhighlight-container .token.selector,.ಠhighlight-container .token.string{color:#690}.ಠhighlight-container .language-css .token.string,.ಠhighlight-container .style .token.string,.ಠhighlight-container .token.entity,.ಠhighlight-container .token.operator,.ಠhighlight-container .token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.ಠhighlight-container .token.atrule,.ಠhighlight-container .token.attr-value,.ಠhighlight-container .token.keyword{color:#07a}.ಠhighlight-container .token.class-name,.ಠhighlight-container .token.function{color:#dd4a68}.ಠhighlight-container .token.important,.ಠhighlight-container .token.regex,.ಠhighlight-container .token.variable{color:#e90}.ಠhighlight-container .token.bold,.ಠhighlight-container .token.important{font-weight:700}.ಠhighlight-container .token.italic{font-style:italic}.ಠhighlight-container .token.entity{cursor:help}</style><style type="text/css" data-react-helmet="true">@font-face{font-family:KaTeX_AMS;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_AMS-Regular.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_AMS-Regular.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_AMS-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Caligraphic;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Caligraphic-Bold.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Caligraphic-Bold.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Caligraphic-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:KaTeX_Caligraphic;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Caligraphic-Regular.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Caligraphic-Regular.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Caligraphic-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Fraktur;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Fraktur-Bold.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Fraktur-Bold.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Fraktur-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:KaTeX_Fraktur;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Fraktur-Regular.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Fraktur-Regular.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Fraktur-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Main;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Main-Bold.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Main-Bold.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Main-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:KaTeX_Main;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Main-BoldItalic.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Main-BoldItalic.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Main-BoldItalic.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:KaTeX_Main;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Main-Italic.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Main-Italic.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Main-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:KaTeX_Main;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Main-Regular.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Main-Regular.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Main-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Math;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Math-BoldItalic.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Math-BoldItalic.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Math-BoldItalic.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:KaTeX_Math;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Math-Italic.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Math-Italic.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Math-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:"KaTeX_SansSerif";src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_SansSerif-Bold.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_SansSerif-Bold.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_SansSerif-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:"KaTeX_SansSerif";src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_SansSerif-Italic.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_SansSerif-Italic.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_SansSerif-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:"KaTeX_SansSerif";src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_SansSerif-Regular.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_SansSerif-Regular.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_SansSerif-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Script;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Script-Regular.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Script-Regular.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Script-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size1;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Size1-Regular.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Size1-Regular.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Size1-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size2;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Size2-Regular.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Size2-Regular.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Size2-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size3;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Size3-Regular.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Size3-Regular.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Size3-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size4;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Size4-Regular.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Size4-Regular.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Size4-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Typewriter;src:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Typewriter-Regular.woff2) format("woff2"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Typewriter-Regular.woff) format("woff"),url(https://plugins-cdn.kancloud.cn/tex/0.0.18/fonts/KaTeX_Typewriter-Regular.ttf) format("truetype");font-weight:400;font-style:normal}.ಠtex-container .katex{font:normal 1.21em KaTeX_Main,Times New Roman,serif;line-height:1.2;text-indent:0;text-rendering:auto}.ಠtex-container .katex *{-ms-high-contrast-adjust:none!important}.ಠtex-container .katex .katex-version:after{content:"0.11.1"}.ಠtex-container .katex .katex-mathml{position:absolute;clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden}.ಠtex-container .katex .katex-html>.newline{display:block}.ಠtex-container .katex .base{position:relative;display:inline-block;white-space:nowrap;width:-webkit-min-content;width:-moz-min-content;width:min-content}.ಠtex-container .katex .strut{display:inline-block}.ಠtex-container .katex .textbf{font-weight:700}.ಠtex-container .katex .textit{font-style:italic}.ಠtex-container .katex .textrm{font-family:KaTeX_Main}.ಠtex-container .katex .textsf{font-family:KaTeX_SansSerif}.ಠtex-container .katex .texttt{font-family:KaTeX_Typewriter}.ಠtex-container .katex .mathdefault{font-family:KaTeX_Math;font-style:italic}.ಠtex-container .katex .mathit{font-family:KaTeX_Main;font-style:italic}.ಠtex-container .katex .mathrm{font-style:normal}.ಠtex-container .katex .mathbf{font-family:KaTeX_Main;font-weight:700}.ಠtex-container .katex .boldsymbol{font-family:KaTeX_Math;font-weight:700;font-style:italic}.ಠtex-container .katex .amsrm,.ಠtex-container .katex .mathbb,.ಠtex-container .katex .textbb{font-family:KaTeX_AMS}.ಠtex-container .katex .mathcal{font-family:KaTeX_Caligraphic}.ಠtex-container .katex .mathfrak,.ಠtex-container .katex .textfrak{font-family:KaTeX_Fraktur}.ಠtex-container .katex .mathtt{font-family:KaTeX_Typewriter}.ಠtex-container .katex .mathscr,.ಠtex-container .katex .textscr{font-family:KaTeX_Script}.ಠtex-container .katex .mathsf,.ಠtex-container .katex .textsf{font-family:KaTeX_SansSerif}.ಠtex-container .katex .mathboldsf,.ಠtex-container .katex .textboldsf{font-family:KaTeX_SansSerif;font-weight:700}.ಠtex-container .katex .mathitsf,.ಠtex-container .katex .textitsf{font-family:KaTeX_SansSerif;font-style:italic}.ಠtex-container .katex .mainrm{font-family:KaTeX_Main;font-style:normal}.ಠtex-container .katex .vlist-t{display:inline-table;table-layout:fixed}.ಠtex-container .katex .vlist-r{display:table-row}.ಠtex-container .katex .vlist{display:table-cell;vertical-align:bottom;position:relative}.ಠtex-container .katex .vlist>span{display:block;height:0;position:relative}.ಠtex-container .katex .vlist>span>span{display:inline-block}.ಠtex-container .katex .vlist>span>.pstrut{overflow:hidden;width:0}.ಠtex-container .katex .vlist-t2{margin-right:-2px}.ಠtex-container .katex .vlist-s{display:table-cell;vertical-align:bottom;font-size:1px;width:2px;min-width:2px}.ಠtex-container .katex .msupsub{text-align:left}.ಠtex-container .katex .mfrac>span>span{text-align:center}.ಠtex-container .katex .mfrac .frac-line{display:inline-block;width:100%;border-bottom-style:solid}.ಠtex-container .katex .hdashline,.ಠtex-container .katex .hline,.ಠtex-container .katex .mfrac .frac-line,.ಠtex-container .katex .overline .overline-line,.ಠtex-container .katex .rule,.ಠtex-container .katex .underline .underline-line{min-height:1px}.ಠtex-container .katex .mspace{display:inline-block}.ಠtex-container .katex .clap,.ಠtex-container .katex .llap,.ಠtex-container .katex .rlap{width:0;position:relative}.ಠtex-container .katex .clap>.inner,.ಠtex-container .katex .llap>.inner,.ಠtex-container .katex .rlap>.inner{position:absolute}.ಠtex-container .katex .clap>.fix,.ಠtex-container .katex .llap>.fix,.ಠtex-container .katex .rlap>.fix{display:inline-block}.ಠtex-container .katex .llap>.inner{right:0}.ಠtex-container .katex .clap>.inner,.ಠtex-container .katex .rlap>.inner{left:0}.ಠtex-container .katex .clap>.inner>span{margin-left:-50%;margin-right:50%}.ಠtex-container .katex .rule{display:inline-block;border:0 solid;position:relative}.ಠtex-container .katex .hline,.ಠtex-container .katex .overline .overline-line,.ಠtex-container .katex .underline .underline-line{display:inline-block;width:100%;border-bottom-style:solid}.ಠtex-container .katex .hdashline{display:inline-block;width:100%;border-bottom-style:dashed}.ಠtex-container .katex .sqrt>.root{margin-left:.27777778em;margin-right:-.55555556em}.ಠtex-container .katex .fontsize-ensurer.reset-size1.size1,.ಠtex-container .katex .sizing.reset-size1.size1{font-size:1em}.ಠtex-container .katex .fontsize-ensurer.reset-size1.size2,.ಠtex-container .katex .sizing.reset-size1.size2{font-size:1.2em}.ಠtex-container .katex .fontsize-ensurer.reset-size1.size3,.ಠtex-container .katex .sizing.reset-size1.size3{font-size:1.4em}.ಠtex-container .katex .fontsize-ensurer.reset-size1.size4,.ಠtex-container .katex .sizing.reset-size1.size4{font-size:1.6em}.ಠtex-container .katex .fontsize-ensurer.reset-size1.size5,.ಠtex-container .katex .sizing.reset-size1.size5{font-size:1.8em}.ಠtex-container .katex .fontsize-ensurer.reset-size1.size6,.ಠtex-container .katex .sizing.reset-size1.size6{font-size:2em}.ಠtex-container .katex .fontsize-ensurer.reset-size1.size7,.ಠtex-container .katex .sizing.reset-size1.size7{font-size:2.4em}.ಠtex-container .katex .fontsize-ensurer.reset-size1.size8,.ಠtex-container .katex .sizing.reset-size1.size8{font-size:2.88em}.ಠtex-container .katex .fontsize-ensurer.reset-size1.size9,.ಠtex-container .katex .sizing.reset-size1.size9{font-size:3.456em}.ಠtex-container .katex .fontsize-ensurer.reset-size1.size10,.ಠtex-container .katex .sizing.reset-size1.size10{font-size:4.148em}.ಠtex-container .katex .fontsize-ensurer.reset-size1.size11,.ಠtex-container .katex .sizing.reset-size1.size11{font-size:4.976em}.ಠtex-container .katex .fontsize-ensurer.reset-size2.size1,.ಠtex-container .katex .sizing.reset-size2.size1{font-size:.83333333em}.ಠtex-container .katex .fontsize-ensurer.reset-size2.size2,.ಠtex-container .katex .sizing.reset-size2.size2{font-size:1em}.ಠtex-container .katex .fontsize-ensurer.reset-size2.size3,.ಠtex-container .katex .sizing.reset-size2.size3{font-size:1.16666667em}.ಠtex-container .katex .fontsize-ensurer.reset-size2.size4,.ಠtex-container .katex .sizing.reset-size2.size4{font-size:1.33333333em}.ಠtex-container .katex .fontsize-ensurer.reset-size2.size5,.ಠtex-container .katex .sizing.reset-size2.size5{font-size:1.5em}.ಠtex-container .katex .fontsize-ensurer.reset-size2.size6,.ಠtex-container .katex .sizing.reset-size2.size6{font-size:1.66666667em}.ಠtex-container .katex .fontsize-ensurer.reset-size2.size7,.ಠtex-container .katex .sizing.reset-size2.size7{font-size:2em}.ಠtex-container .katex .fontsize-ensurer.reset-size2.size8,.ಠtex-container .katex .sizing.reset-size2.size8{font-size:2.4em}.ಠtex-container .katex .fontsize-ensurer.reset-size2.size9,.ಠtex-container .katex .sizing.reset-size2.size9{font-size:2.88em}.ಠtex-container .katex .fontsize-ensurer.reset-size2.size10,.ಠtex-container .katex .sizing.reset-size2.size10{font-size:3.45666667em}.ಠtex-container .katex .fontsize-ensurer.reset-size2.size11,.ಠtex-container .katex .sizing.reset-size2.size11{font-size:4.14666667em}.ಠtex-container .katex .fontsize-ensurer.reset-size3.size1,.ಠtex-container .katex .sizing.reset-size3.size1{font-size:.71428571em}.ಠtex-container .katex .fontsize-ensurer.reset-size3.size2,.ಠtex-container .katex .sizing.reset-size3.size2{font-size:.85714286em}.ಠtex-container .katex .fontsize-ensurer.reset-size3.size3,.ಠtex-container .katex .sizing.reset-size3.size3{font-size:1em}.ಠtex-container .katex .fontsize-ensurer.reset-size3.size4,.ಠtex-container .katex .sizing.reset-size3.size4{font-size:1.14285714em}.ಠtex-container .katex .fontsize-ensurer.reset-size3.size5,.ಠtex-container .katex .sizing.reset-size3.size5{font-size:1.28571429em}.ಠtex-container .katex .fontsize-ensurer.reset-size3.size6,.ಠtex-container .katex .sizing.reset-size3.size6{font-size:1.42857143em}.ಠtex-container .katex .fontsize-ensurer.reset-size3.size7,.ಠtex-container .katex .sizing.reset-size3.size7{font-size:1.71428571em}.ಠtex-container .katex .fontsize-ensurer.reset-size3.size8,.ಠtex-container .katex .sizing.reset-size3.size8{font-size:2.05714286em}.ಠtex-container .katex .fontsize-ensurer.reset-size3.size9,.ಠtex-container .katex .sizing.reset-size3.size9{font-size:2.46857143em}.ಠtex-container .katex .fontsize-ensurer.reset-size3.size10,.ಠtex-container .katex .sizing.reset-size3.size10{font-size:2.96285714em}.ಠtex-container .katex .fontsize-ensurer.reset-size3.size11,.ಠtex-container .katex .sizing.reset-size3.size11{font-size:3.55428571em}.ಠtex-container .katex .fontsize-ensurer.reset-size4.size1,.ಠtex-container .katex .sizing.reset-size4.size1{font-size:.625em}.ಠtex-container .katex .fontsize-ensurer.reset-size4.size2,.ಠtex-container .katex .sizing.reset-size4.size2{font-size:.75em}.ಠtex-container .katex .fontsize-ensurer.reset-size4.size3,.ಠtex-container .katex .sizing.reset-size4.size3{font-size:.875em}.ಠtex-container .katex .fontsize-ensurer.reset-size4.size4,.ಠtex-container .katex .sizing.reset-size4.size4{font-size:1em}.ಠtex-container .katex .fontsize-ensurer.reset-size4.size5,.ಠtex-container .katex .sizing.reset-size4.size5{font-size:1.125em}.ಠtex-container .katex .fontsize-ensurer.reset-size4.size6,.ಠtex-container .katex .sizing.reset-size4.size6{font-size:1.25em}.ಠtex-container .katex .fontsize-ensurer.reset-size4.size7,.ಠtex-container .katex .sizing.reset-size4.size7{font-size:1.5em}.ಠtex-container .katex .fontsize-ensurer.reset-size4.size8,.ಠtex-container .katex .sizing.reset-size4.size8{font-size:1.8em}.ಠtex-container .katex .fontsize-ensurer.reset-size4.size9,.ಠtex-container .katex .sizing.reset-size4.size9{font-size:2.16em}.ಠtex-container .katex .fontsize-ensurer.reset-size4.size10,.ಠtex-container .katex .sizing.reset-size4.size10{font-size:2.5925em}.ಠtex-container .katex .fontsize-ensurer.reset-size4.size11,.ಠtex-container .katex .sizing.reset-size4.size11{font-size:3.11em}.ಠtex-container .katex .fontsize-ensurer.reset-size5.size1,.ಠtex-container .katex .sizing.reset-size5.size1{font-size:.55555556em}.ಠtex-container .katex .fontsize-ensurer.reset-size5.size2,.ಠtex-container .katex .sizing.reset-size5.size2{font-size:.66666667em}.ಠtex-container .katex .fontsize-ensurer.reset-size5.size3,.ಠtex-container .katex .sizing.reset-size5.size3{font-size:.77777778em}.ಠtex-container .katex .fontsize-ensurer.reset-size5.size4,.ಠtex-container .katex .sizing.reset-size5.size4{font-size:.88888889em}.ಠtex-container .katex .fontsize-ensurer.reset-size5.size5,.ಠtex-container .katex .sizing.reset-size5.size5{font-size:1em}.ಠtex-container .katex .fontsize-ensurer.reset-size5.size6,.ಠtex-container .katex .sizing.reset-size5.size6{font-size:1.11111111em}.ಠtex-container .katex .fontsize-ensurer.reset-size5.size7,.ಠtex-container .katex .sizing.reset-size5.size7{font-size:1.33333333em}.ಠtex-container .katex .fontsize-ensurer.reset-size5.size8,.ಠtex-container .katex .sizing.reset-size5.size8{font-size:1.6em}.ಠtex-container .katex .fontsize-ensurer.reset-size5.size9,.ಠtex-container .katex .sizing.reset-size5.size9{font-size:1.92em}.ಠtex-container .katex .fontsize-ensurer.reset-size5.size10,.ಠtex-container .katex .sizing.reset-size5.size10{font-size:2.30444444em}.ಠtex-container .katex .fontsize-ensurer.reset-size5.size11,.ಠtex-container .katex .sizing.reset-size5.size11{font-size:2.76444444em}.ಠtex-container .katex .fontsize-ensurer.reset-size6.size1,.ಠtex-container .katex .sizing.reset-size6.size1{font-size:.5em}.ಠtex-container .katex .fontsize-ensurer.reset-size6.size2,.ಠtex-container .katex .sizing.reset-size6.size2{font-size:.6em}.ಠtex-container .katex .fontsize-ensurer.reset-size6.size3,.ಠtex-container .katex .sizing.reset-size6.size3{font-size:.7em}.ಠtex-container .katex .fontsize-ensurer.reset-size6.size4,.ಠtex-container .katex .sizing.reset-size6.size4{font-size:.8em}.ಠtex-container .katex .fontsize-ensurer.reset-size6.size5,.ಠtex-container .katex .sizing.reset-size6.size5{font-size:.9em}.ಠtex-container .katex .fontsize-ensurer.reset-size6.size6,.ಠtex-container .katex .sizing.reset-size6.size6{font-size:1em}.ಠtex-container .katex .fontsize-ensurer.reset-size6.size7,.ಠtex-container .katex .sizing.reset-size6.size7{font-size:1.2em}.ಠtex-container .katex .fontsize-ensurer.reset-size6.size8,.ಠtex-container .katex .sizing.reset-size6.size8{font-size:1.44em}.ಠtex-container .katex .fontsize-ensurer.reset-size6.size9,.ಠtex-container .katex .sizing.reset-size6.size9{font-size:1.728em}.ಠtex-container .katex .fontsize-ensurer.reset-size6.size10,.ಠtex-container .katex .sizing.reset-size6.size10{font-size:2.074em}.ಠtex-container .katex .fontsize-ensurer.reset-size6.size11,.ಠtex-container .katex .sizing.reset-size6.size11{font-size:2.488em}.ಠtex-container .katex .fontsize-ensurer.reset-size7.size1,.ಠtex-container .katex .sizing.reset-size7.size1{font-size:.41666667em}.ಠtex-container .katex .fontsize-ensurer.reset-size7.size2,.ಠtex-container .katex .sizing.reset-size7.size2{font-size:.5em}.ಠtex-container .katex .fontsize-ensurer.reset-size7.size3,.ಠtex-container .katex .sizing.reset-size7.size3{font-size:.58333333em}.ಠtex-container .katex .fontsize-ensurer.reset-size7.size4,.ಠtex-container .katex .sizing.reset-size7.size4{font-size:.66666667em}.ಠtex-container .katex .fontsize-ensurer.reset-size7.size5,.ಠtex-container .katex .sizing.reset-size7.size5{font-size:.75em}.ಠtex-container .katex .fontsize-ensurer.reset-size7.size6,.ಠtex-container .katex .sizing.reset-size7.size6{font-size:.83333333em}.ಠtex-container .katex .fontsize-ensurer.reset-size7.size7,.ಠtex-container .katex .sizing.reset-size7.size7{font-size:1em}.ಠtex-container .katex .fontsize-ensurer.reset-size7.size8,.ಠtex-container .katex .sizing.reset-size7.size8{font-size:1.2em}.ಠtex-container .katex .fontsize-ensurer.reset-size7.size9,.ಠtex-container .katex .sizing.reset-size7.size9{font-size:1.44em}.ಠtex-container .katex .fontsize-ensurer.reset-size7.size10,.ಠtex-container .katex .sizing.reset-size7.size10{font-size:1.72833333em}.ಠtex-container .katex .fontsize-ensurer.reset-size7.size11,.ಠtex-container .katex .sizing.reset-size7.size11{font-size:2.07333333em}.ಠtex-container .katex .fontsize-ensurer.reset-size8.size1,.ಠtex-container .katex .sizing.reset-size8.size1{font-size:.34722222em}.ಠtex-container .katex .fontsize-ensurer.reset-size8.size2,.ಠtex-container .katex .sizing.reset-size8.size2{font-size:.41666667em}.ಠtex-container .katex .fontsize-ensurer.reset-size8.size3,.ಠtex-container .katex .sizing.reset-size8.size3{font-size:.48611111em}.ಠtex-container .katex .fontsize-ensurer.reset-size8.size4,.ಠtex-container .katex .sizing.reset-size8.size4{font-size:.55555556em}.ಠtex-container .katex .fontsize-ensurer.reset-size8.size5,.ಠtex-container .katex .sizing.reset-size8.size5{font-size:.625em}.ಠtex-container .katex .fontsize-ensurer.reset-size8.size6,.ಠtex-container .katex .sizing.reset-size8.size6{font-size:.69444444em}.ಠtex-container .katex .fontsize-ensurer.reset-size8.size7,.ಠtex-container .katex .sizing.reset-size8.size7{font-size:.83333333em}.ಠtex-container .katex .fontsize-ensurer.reset-size8.size8,.ಠtex-container .katex .sizing.reset-size8.size8{font-size:1em}.ಠtex-container .katex .fontsize-ensurer.reset-size8.size9,.ಠtex-container .katex .sizing.reset-size8.size9{font-size:1.2em}.ಠtex-container .katex .fontsize-ensurer.reset-size8.size10,.ಠtex-container .katex .sizing.reset-size8.size10{font-size:1.44027778em}.ಠtex-container .katex .fontsize-ensurer.reset-size8.size11,.ಠtex-container .katex .sizing.reset-size8.size11{font-size:1.72777778em}.ಠtex-container .katex .fontsize-ensurer.reset-size9.size1,.ಠtex-container .katex .sizing.reset-size9.size1{font-size:.28935185em}.ಠtex-container .katex .fontsize-ensurer.reset-size9.size2,.ಠtex-container .katex .sizing.reset-size9.size2{font-size:.34722222em}.ಠtex-container .katex .fontsize-ensurer.reset-size9.size3,.ಠtex-container .katex .sizing.reset-size9.size3{font-size:.40509259em}.ಠtex-container .katex .fontsize-ensurer.reset-size9.size4,.ಠtex-container .katex .sizing.reset-size9.size4{font-size:.46296296em}.ಠtex-container .katex .fontsize-ensurer.reset-size9.size5,.ಠtex-container .katex .sizing.reset-size9.size5{font-size:.52083333em}.ಠtex-container .katex .fontsize-ensurer.reset-size9.size6,.ಠtex-container .katex .sizing.reset-size9.size6{font-size:.5787037em}.ಠtex-container .katex .fontsize-ensurer.reset-size9.size7,.ಠtex-container .katex .sizing.reset-size9.size7{font-size:.69444444em}.ಠtex-container .katex .fontsize-ensurer.reset-size9.size8,.ಠtex-container .katex .sizing.reset-size9.size8{font-size:.83333333em}.ಠtex-container .katex .fontsize-ensurer.reset-size9.size9,.ಠtex-container .katex .sizing.reset-size9.size9{font-size:1em}.ಠtex-container .katex .fontsize-ensurer.reset-size9.size10,.ಠtex-container .katex .sizing.reset-size9.size10{font-size:1.20023148em}.ಠtex-container .katex .fontsize-ensurer.reset-size9.size11,.ಠtex-container .katex .sizing.reset-size9.size11{font-size:1.43981481em}.ಠtex-container .katex .fontsize-ensurer.reset-size10.size1,.ಠtex-container .katex .sizing.reset-size10.size1{font-size:.24108004em}.ಠtex-container .katex .fontsize-ensurer.reset-size10.size2,.ಠtex-container .katex .sizing.reset-size10.size2{font-size:.28929605em}.ಠtex-container .katex .fontsize-ensurer.reset-size10.size3,.ಠtex-container .katex .sizing.reset-size10.size3{font-size:.33751205em}.ಠtex-container .katex .fontsize-ensurer.reset-size10.size4,.ಠtex-container .katex .sizing.reset-size10.size4{font-size:.38572806em}.ಠtex-container .katex .fontsize-ensurer.reset-size10.size5,.ಠtex-container .katex .sizing.reset-size10.size5{font-size:.43394407em}.ಠtex-container .katex .fontsize-ensurer.reset-size10.size6,.ಠtex-container .katex .sizing.reset-size10.size6{font-size:.48216008em}.ಠtex-container .katex .fontsize-ensurer.reset-size10.size7,.ಠtex-container .katex .sizing.reset-size10.size7{font-size:.57859209em}.ಠtex-container .katex .fontsize-ensurer.reset-size10.size8,.ಠtex-container .katex .sizing.reset-size10.size8{font-size:.69431051em}.ಠtex-container .katex .fontsize-ensurer.reset-size10.size9,.ಠtex-container .katex .sizing.reset-size10.size9{font-size:.83317261em}.ಠtex-container .katex .fontsize-ensurer.reset-size10.size10,.ಠtex-container .katex .sizing.reset-size10.size10{font-size:1em}.ಠtex-container .katex .fontsize-ensurer.reset-size10.size11,.ಠtex-container .katex .sizing.reset-size10.size11{font-size:1.19961427em}.ಠtex-container .katex .fontsize-ensurer.reset-size11.size1,.ಠtex-container .katex .sizing.reset-size11.size1{font-size:.20096463em}.ಠtex-container .katex .fontsize-ensurer.reset-size11.size2,.ಠtex-container .katex .sizing.reset-size11.size2{font-size:.24115756em}.ಠtex-container .katex .fontsize-ensurer.reset-size11.size3,.ಠtex-container .katex .sizing.reset-size11.size3{font-size:.28135048em}.ಠtex-container .katex .fontsize-ensurer.reset-size11.size4,.ಠtex-container .katex .sizing.reset-size11.size4{font-size:.32154341em}.ಠtex-container .katex .fontsize-ensurer.reset-size11.size5,.ಠtex-container .katex .sizing.reset-size11.size5{font-size:.36173633em}.ಠtex-container .katex .fontsize-ensurer.reset-size11.size6,.ಠtex-container .katex .sizing.reset-size11.size6{font-size:.40192926em}.ಠtex-container .katex .fontsize-ensurer.reset-size11.size7,.ಠtex-container .katex .sizing.reset-size11.size7{font-size:.48231511em}.ಠtex-container .katex .fontsize-ensurer.reset-size11.size8,.ಠtex-container .katex .sizing.reset-size11.size8{font-size:.57877814em}.ಠtex-container .katex .fontsize-ensurer.reset-size11.size9,.ಠtex-container .katex .sizing.reset-size11.size9{font-size:.69453376em}.ಠtex-container .katex .fontsize-ensurer.reset-size11.size10,.ಠtex-container .katex .sizing.reset-size11.size10{font-size:.83360129em}.ಠtex-container .katex .fontsize-ensurer.reset-size11.size11,.ಠtex-container .katex .sizing.reset-size11.size11{font-size:1em}.ಠtex-container .katex .delimsizing.size1{font-family:KaTeX_Size1}.ಠtex-container .katex .delimsizing.size2{font-family:KaTeX_Size2}.ಠtex-container .katex .delimsizing.size3{font-family:KaTeX_Size3}.ಠtex-container .katex .delimsizing.size4{font-family:KaTeX_Size4}.ಠtex-container .katex .delimsizing.mult .delim-size1>span{font-family:KaTeX_Size1}.ಠtex-container .katex .delimsizing.mult .delim-size4>span{font-family:KaTeX_Size4}.ಠtex-container .katex .nulldelimiter{display:inline-block;width:.12em}.ಠtex-container .katex .delimcenter,.ಠtex-container .katex .op-symbol{position:relative}.ಠtex-container .katex .op-symbol.small-op{font-family:KaTeX_Size1}.ಠtex-container .katex .op-symbol.large-op{font-family:KaTeX_Size2}.ಠtex-container .katex .accent>.vlist-t,.ಠtex-container .katex .op-limits>.vlist-t{text-align:center}.ಠtex-container .katex .accent .accent-body{position:relative}.ಠtex-container .katex .accent .accent-body:not(.accent-full){width:0}.ಠtex-container .katex .overlay{display:block}.ಠtex-container .katex .mtable .vertical-separator{display:inline-block;min-width:1px}.ಠtex-container .katex .mtable .arraycolsep{display:inline-block}.ಠtex-container .katex .mtable .col-align-c>.vlist-t{text-align:center}.ಠtex-container .katex .mtable .col-align-l>.vlist-t{text-align:left}.ಠtex-container .katex .mtable .col-align-r>.vlist-t{text-align:right}.ಠtex-container .katex .svg-align{text-align:left}.ಠtex-container .katex svg{display:block;position:absolute;width:100%;height:inherit;fill:currentColor;stroke:currentColor;fill-rule:nonzero;fill-opacity:1;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1}.ಠtex-container .katex svg path{stroke:none}.ಠtex-container .katex img{border-style:none;min-width:0;min-height:0;max-width:none;max-height:none}.ಠtex-container .katex .stretchy{width:100%;display:block;position:relative;overflow:hidden}.ಠtex-container .katex .stretchy:after,.ಠtex-container .katex .stretchy:before{content:""}.ಠtex-container .katex .hide-tail{width:100%;position:relative;overflow:hidden}.ಠtex-container .katex .halfarrow-left{position:absolute;left:0;width:50.2%;overflow:hidden}.ಠtex-container .katex .halfarrow-right{position:absolute;right:0;width:50.2%;overflow:hidden}.ಠtex-container .katex .brace-left{position:absolute;left:0;width:25.1%;overflow:hidden}.ಠtex-container .katex .brace-center{position:absolute;left:25%;width:50%;overflow:hidden}.ಠtex-container .katex .brace-right{position:absolute;right:0;width:25.1%;overflow:hidden}.ಠtex-container .katex .x-arrow-pad{padding:0 .5em}.ಠtex-container .katex .mover,.ಠtex-container .katex .munder,.ಠtex-container .katex .x-arrow{text-align:center}.ಠtex-container .katex .boxpad{padding:0 .3em}.ಠtex-container .katex .fbox,.ಠtex-container .katex .fcolorbox{box-sizing:border-box;border:.04em solid}.ಠtex-container .katex .cancel-pad{padding:0 .2em}.ಠtex-container .katex .cancel-lap{margin-left:-.2em;margin-right:-.2em}.ಠtex-container .katex .sout{border-bottom-style:solid;border-bottom-width:.08em}.ಠtex-container .katex-display{display:block;margin:1em 0;text-align:center}.ಠtex-container .katex-display>.katex{display:block;text-align:center;white-space:nowrap}.ಠtex-container .katex-display>.katex>.katex-html{display:block;position:relative}.ಠtex-container .katex-display>.katex>.katex-html>.tag{position:absolute;right:0}.ಠtex-container .katex-display.leqno>.katex>.katex-html>.tag{left:0;right:auto}.ಠtex-container .katex-display.fleqn>.katex{text-align:left}.ಠtex-container .mathjax-editor-input{left:-999999px}.ಠtex-container.ಠtex-block{text-align:center}.ಠtex-container.ಠtex-inline{margin:0 5px}.ಠtex-modal .mathjax-editor-input{left:-999999px!important}.ಠtex-modal .mathjax-editor-container{text-align:center;font-size:24px;padding:60px 0}.ಠtex-modal .ಠtex-toolbar{width:100%;padding:1px 10px;position:relative;z-index:2;background-color:#f6f5ee;border-bottom:1px solid #ccc;color:#000}.ಠtex-modal .ಠtex-toolbar .ಠtex-button{padding:8px 6px;height:97px;font-size:12px;display:inline-block;border:1px solid transparent;border-radius:3px;cursor:default;position:relative;z-index:3;vertical-align:top;margin-right:1px}.ಠtex-modal .ಠtex-toolbar .ಠtex-button .ಠtex-icon{width:32px;height:32px;margin:2px auto;background:url(https://plugins-cdn.kancloud.cn/tex/0.0.18/images/btn.png) 0 0 no-repeat}.ಠtex-modal .ಠtex-toolbar .ಠtex-button .ಠtex-label{color:#666;text-align:center;display:block;font-size:12px;line-height:20px}.ಠtex-modal .ಠtex-toolbar .ಠtex-button .ಠtex-label .ಠtex-sign{border:4px solid transparent;border-top-color:#2d2d2d;width:0;height:0;display:inline-block;margin:8px auto;vertical-align:top}.ಠtex-modal .ಠtex-toolbar .ಠtex-yushe .ಠtex-icon{width:40px}.ಠtex-modal .ಠtex-toolbar .ಠtex-area{height:97px;cursor:default;opacity:.5;z-index:4;border:1px solid #e0dfd5;border-radius:4px;background:#fff;margin:8px 10px}.ಠtex-modal .ಠtex-toolbar .ಠtex-area,.ಠtex-modal .ಠtex-toolbar .ಠtex-area .ಠtex-container{display:inline-block;position:relative;vertical-align:top}.ಠtex-modal .ಠtex-toolbar .ಠtex-area .ಠtex-container{width:293px;height:70px;margin:5px;border-right:0;top:0;left:0;overflow:hidden}.ಠtex-modal .ಠtex-toolbar .ಠtex-area .ಠtex-container .ಠtex-panel{position:absolute;top:0;left:0;line-height:0;background:#fff;transition:top .5s linear}.ಠtex-modal .ಠtex-toolbar .ಠtex-area .ಠtex-container .ಠtex-panel .ಠtex-item{width:26px;height:26px;position:absolute;top:0;left:0}.ಠtex-modal .ಠtex-toolbar .ಠtex-area .ಠtex-container .ಠtex-panel .ಠtex-item .ಠtex-inner{width:34px;height:34px;border:1px solid #fff;position:absolute;top:-4px;left:-4px;transition:all .1s linear;transform:scale(.76)}.ಠtex-modal .ಠtex-toolbar .ಠtex-area .ಠtex-container .ಠtex-panel .ಠtex-item .ಠtex-inner:hover{transform:scale(1)}.ಠtex-modal .ಠtex-toolbar .ಠtex-area .ಠtex-container .ಠtex-panel .ಠtex-item .ಠtex-inner .ಠtex-img{width:32px;height:32px;border:1px solid grey;transition:all .1s linear}</style></head>
<body style="">
<div id="main"><div class="window-container"><img src="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/lianghuajiaocheng2!middle" style="position: absolute; visibility: hidden;"><div><div class="Loading__loading___1m_fZ"><div class="Loading__bar___21yOt" style="background: rgb(33, 186, 69); width: 0%; display: none;"><div class="Loading__peg___3Y_28"></div></div></div><div class="Loading__spinner___11Pm4"><div class="Loading__icon___3OOyu" style="display: none; border-color: rgb(33, 186, 69);"></div></div></div><div class="window-body with-sidebar"><div class="sidebar"><div class="sidebar-header"><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2" data-no-pjax="true" class="title">量化教程1.02</a><div class="search-form"><div class="ui small fluid icon input"><input type="text" placeholder="请输入搜索关键词..."><i class="icon search"></i></div></div></div><div class="sidebar-body"><div class="catalog-body"><ul><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318041" class="text">导语</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318042" class="text">第一章 初识量化交易</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318043" class="text">第二章 量化策略的基本框架</a></li><li class="open"><div class="wholerow"></div><i class="icon caret down"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318044" class="text">第三章 我的基本框架</a><ul><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318045" class="text">我的代码框架（附源代码）</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318046" class="text">怎么使用我的代码框架</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318047" class="text">三份重要的作业</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318048" class="text">代码框架图解（附录）</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318049" class="text">代码段详解（附录）</a></li></ul></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318050" class="text">第四章 获取典型常用数据</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318051" class="text">第五章 策略评价与建立模拟</a></li><li class="open"><div class="wholerow"></div><i class="icon caret down"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318052" class="text">第六章 经典策略学习</a><ul><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318053" class="text">RSRS择时+基本面选股</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318054" class="text">网格交易</a></li><li class="active"><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318055" class="text">彼得林奇PEG策略</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318056" class="text">股指期货对冲策略</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318057" class="text">涨停回调短线策略</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318058" class="text">净利润断层策略</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318059" class="text">趋势形态策略</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318060" class="text">医药股策略</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318061" class="text">超跌次新股策略</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318062" class="text">医药消费低估高增长策略</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318063" class="text">ROA择时策略</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318064" class="text">科创板医疗医药股策略</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2425451" class="text">净利润断层修正版</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2479237" class="text">动量简单</a></li></ul></li><li class=""><div class="wholerow"></div><i class="icon caret right"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318065" class="text">第七章 python编程</a><ul><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318066" class="text">python学习资源</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318067" class="text">python基础（快速学习）聚宽版</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318068" class="text">python使用语句集合（聚宽）</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318069" class="text">python系统学习【第一课】</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318070" class="text">python系统学习【第二课】</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318071" class="text">python系统学习【第三课】</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318072" class="text">python系统学习【第四课】</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318073" class="text">python系统学习【第五课】</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318074" class="text">python系统学习【第六课】</a></li></ul></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318075" class="text">第八章 实盘交易</a></li></ul></div></div><div class="sidebar-copyright">本文档使用 <a href="https://www.kancloud.cn/" target="_blank">看云</a> 构建</div></div><div class="workspace"><div class="article"><div class="article-head"><div class="left tools"><a class="item icon"><i class="icon align justify"></i></a></div><h1>彼得林奇PEG策略</h1><div class="right tools"><div role="listbox" aria-expanded="false" class="ui top right pointing dropdown item" tabindex="0"><div class="text" role="alert" aria-live="polite"></div><i aria-hidden="true" class="share alternate icon"></i><div class="menu transition"><div role="option" class="item"><i aria-hidden="true" class="linkify icon"></i><span class="text">复制链接</span></div><div role="option" class="item"><i aria-hidden="true" class="qq icon"></i><span class="text">腾讯QQ</span></div><div role="option" class="item"><i aria-hidden="true" class="weibo icon"></i><span class="text">新浪微博</span></div><div class="header"><p><i class="icon wechat"></i><span class="text">微信扫一扫</span></p><img src="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/barCode"></div></div></div></div></div><div class="article-body kancloud-markdown-body"><h1><a id="PEG_0"></a>彼得林奇PEG策略</h1>
<hr>
<p>出处：聚宽-宏观占卜师&amp;小兵哥<br><strong>导语</strong>：投资大师彼得·林奇（Peter Lynch）有过一个著名的论断：任何一家公司股票如果定价合理的话，市盈率就会与收益增长率相等。这就是PEG估值法，PEG在综合考虑了低风险以及未来成长性的因素，可用于股票价值评估。本文浅谈“PEG估值法”，并给出策略，进行回测。</p>
<p><img src="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/88635577625f24bdd04e4e3399dde0a2" alt="Peter Lynch photo.jpg"></p>
<hr>
<h4><a id="1PEG_11"></a><strong>1.彼得·林奇与PEG估值法</strong></h4>
<p><strong>财富的化身--彼得·林奇</strong><br>
彼得·林奇（Peter Lynch）生于1944年1月19日，是一位卓越的投资家，曾被《时代杂志》评为首席基金经理。1977年至1990年，在彼得·林奇管理麦哲伦基金的13年间，基金规模大幅扩增，由2000万美元成长至140亿美元！一跃成为全球之最。<br>
彼得·林奇在投资上的功绩和影响，几乎无人能及。今天，我们介绍一下彼得·林奇推广的“PEG估值法”，来体会大师的投资思想。</p>
<p><strong>PEG估值法简介</strong><br>
达·芬奇说过：”把最复杂的变成最简单的，才是最高明的。“PEG估值法就很好的体现了这个思想。下面，小编给出PEG的估值原理。<br>
一言以蔽之：计算每只股票的PEG值，并排序，取PEG值最小的前n支股票，作为待买股票即可！</p>
<p><img src="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/57793420f3de31f386b970d9fea51f88" alt="PEG好低！买买买.jpg"></p>
<p>那么，这个PEG究竟是什么呢？<br>
先介绍几个基本概念：</p>
<p>1.<strong>EPS(Earnings Per Share)<strong>表示</strong>每股收益</strong>（一般按年计算）:</p>
<p><img src="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/2a4f165066899fc00025208486ac254b_1058x145.png" alt=""></p>
<p>2.<strong>PE（Price to Earning Ratio）<strong>表示</strong>市盈率</strong>，是当前股价（P）相对每股收益（EPS）的比值：</p>
<p><img src="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/0bfc4f3d34b5847e911397c18508ad4b_889x106.png" alt=""></p>
<p>将EPS按照不同的计算法方法取出，我们可以得出适用范围不同的PE（市盈率）：</p>
<p>若每股收益(EPS)取最近4次的季报的每股收益的平均值，则计算出“滚动市盈率”（又称市盈率TTM）；</p>
<p>若每股收益(EPS)取去年的12个月的每股收益，则计算出“静态市盈率”（又称市盈率LYR）；</p>
<p>若每股收益(EPS)取预测下一年的每股收益，则计算出“动态市盈率”。</p>
<p><strong>本文取“市盈率TTM”，更加接近现实，靠谱。</strong></p>
<h4><a id="_49"></a></h4>
<h4><a id="_50"></a></h4>
<p>3.<strong>G（Growth Rate of Expected Profit）<strong>表示企业的</strong>收益增长率</strong>。收益增长率的计算方法不一，简便起见，<strong>本文取EPS增长率</strong>：</p>
<p><img src="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/f2e36e3785adc7085241811adc46a03e_1203x120.png" alt=""></p>
<p>4.基于以上几个指标，得出<strong>PEG的计算公式</strong>:</p>
<p><img src="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/572f5673f488b523f4a98d1cfcea0861_1193x119.png" alt=""></p>
<p>从以上公式可以看出，PE蕴含着股价的信息，PEG是一个股价相对于收益增长率的比值。直观来讲，PEG越高，代表该公司的股价有被高估的可能性，不建议买。反之，PEG越低，代表该公司的股价有被低估的可能性，考虑买入(<em>*一般情况下，PEG越低越好</em>)。</p>
<h4><a id="2PEG_64"></a><strong>2.PEG估值法的适用条件</strong></h4>
<p>PEG是一个综合指标，既考察价值，又兼顾成长性。不难看出，PEG估值法侧重于成长型的公司，非常适合对成长型公司的股票价值评估。马克思说过:“任何真理都有自己适用的条件和范围。”在投资的世界里，倘若不在合适的范围内进行操作，就不是一个好策略。</p>
<h4><a id="_67"></a></h4>
<p>要想成为一个好策略，就必须预先过滤股票池，筛选出符合PEG估值法运用条件的股票。以下几种情况就<strong>不适合用PEG估值法</strong>进行估值：</p>
<p><img src="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/5f380ff52dec2894b977d38912b0e00e" alt="table 1.png"></p>
<p>本文仅对股票池的“非成长股”进行排除，有兴趣的用户，可以进行多次过滤。</p>
<h4><a id="3PEG_78"></a><strong>3.利用PEG寻找成倍牛股</strong></h4>
<p>PEG估值法是彼得·林奇用作评估成长型公司价值的方法。PEG数值通常可分为四档：</p>
<p><img src="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/498e8b08d72ac60b3183cd326679c3fc" alt="table 2.png"></p>
<p>目前，我国处于高速发展的经济中，我们对A股高成长型公司的合理估值可以定为：PEG=1。举几个例子：</p>
<p><img src="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/013e3a95ca49a6fce7d416639c6100f2" alt="table 3.png"></p>
<p>大家理解了吗？C公司就是那支能为你带来N倍收益的牛股，依照PEG估值法的思想，PEG值越低越牛哦！！！</p>
<h4><a id="4_96"></a><strong>4.策略思路</strong></h4>
<p><strong>step1：</strong><br>
设置沪深300为初始股票池，实际情况中，当天停牌的股票是无法进行买卖操作的，所以在整体回测前，将当日停牌的股票剔除，得到可行股票池。</p>
<h4><a id="_100"></a></h4>
<p><strong>step2:</strong><br>
前面已说明，本策略仅对成长股有效，所以仅仅过滤掉当日停牌的股票是不完善的。仍需过滤掉市盈率（PE）为负值，或收益增长率（G）为负值的股票。聚宽平台的取数据函数get_fundamentals可以直接取PE，G值（详见【<a href="https://www.joinquant.com/data" target="_blank">数据</a>】模块的<a href="https://www.joinquant.com/fundamentals" target="_blank">股票财务数据</a>）。<a href="https://www.joinquant.com/api#getfundamentals" target="_blank">get_fundamentals</a>函数的默认日期是context.current_dt的前一天（详见API）,因为当天是无法知道今日的某些数据的。本策略使用默认值（缺省），避免未来函数，不建议修改。</p>
<h4><a id="_103"></a></h4>
<p><strong>step3：</strong><br>
整体思路是非常简洁的，下面对股票的PEG进行排序，取出PEG最小(且全都小于0.5)的前n只支股票，作为调仓时待买入的股票列表。</p>
<h4><a id="_106"></a></h4>
<p><strong>step4：</strong><br>
每次调仓时，先卖后买，腾出资金。对不在待买入列表的股票，执行卖出操作。对在待买入列表的股票，分配资金，执行买入操作。</p>
<h4><a id="5PEG_111"></a><strong>5.应用PEG估值法的误区</strong></h4>
<p>在克隆（见文末，附源码）本策略之前，小编给大家列了一些预先需要注意的地方，防患于未然哈：</p>
<h4><a id="_114"></a></h4>
<p>1.取市盈率和收益增长率数据时，应该取回测当天的前一天的数据，避免未来函数。在聚宽平台，取数据函数<a href="https://www.joinquant.com/api#getfundamentals" target="_blank">get_fundamentals</a>时间默认值是回测前一天，保持默认即可，不建议修改。</p>
<h4><a id="_117"></a></h4>
<p>2.计算出的PEG值并非越小越好，因为计算PEG时所用的收益增长率，是过去n年平均指标这样的历史数据。实际上，决定上市公司潜力的是其未来的增长率。目前小PEG的公司并不代表其今后这一数值一定就小。</p>
<h4><a id="_119"></a></h4>
<p>3.怎样选择高增长的公司？<br>
重要的是你选择的公司是要处在高增长的行业，比如互联网、环保、新材料、医药等，行业高增长是企业高增长的基石。选对了行业，再选择行业内的佼佼者即可。</p>
<h4><a id="_122"></a></h4>
<p>4.市盈率或收益增长率为负的公司怎么计算PEG?<br>
这种公司没什么的研究价值。</p>
<h4><a id="_125"></a></h4>
<p>5.市盈率用静态LYR?？滚动TTM？还是动态的?<br>
市盈率LYR: 以上一年度每股收益计算的市盈率。靠谱，但信息陈旧。<br>
市盈率TTM: 以最近四个季度每股收益计算的市盈率。靠谱，更接近现实。<br>
动态市盈率：以未来一年每股收益计算的市盈率。取决于行业研究员的财务报表的数据分析，具有预测未来的效果。<br>
其中，市盈率LYR和市盈率TTM可以用聚宽平台<a href="https://www.joinquant.com/api#getfundamentals" target="_blank">get_fundamentals</a>函数直接取（见<a href="https://www.joinquant.com/api" target="_blank">API</a>和<a href="https://www.joinquant.com/data" target="_blank">数据</a>模块的<a href="https://www.joinquant.com/fundamentals" target="_blank">股票财务数据</a>）。</p>
<h4><a id="_131"></a></h4>
<p>上面是聚宽的宏观经济占卜师做的，然后聚宽的小兵哥在这智商又做了一些修正，主要修正了以下条件：</p>
<h4><a id="_133"></a></h4>
<p>1、引入修正 PEG，把分红加入到了计算 PEG 的过程中去；<br>
2、剔除了周期性行业、项目类公司；<br>
3、参考彼得林奇的原文，剔除掉增长 &gt;50 的股票（原文是要密切关注，因为高增长不可持续，实现里是直接剔除）<br>
4、修改了配仓策略，从等权重变更为风险平价<br>
5、日波动约束在 3% 以内；<br>
6、最大持仓 5 个股票，30个交易日调仓一次，无择时，无止损<br>
7、PEG &lt; 0.5，进入待选股；按照市值排序，优先买入市值低的（彼得林奇原文也是市值小的优先）<br>
8、卖条件，如果选进的股票&gt;5 个，则清光持仓；如果 1.0 才清掉。</p>
<h4><a id="6_143"></a><strong>6.策略源码</strong></h4>
<p>可以直接复制到聚宽，运行</p>
<pre><code class="ಠhighlight-container">
import numpy as np
import talib
import pandas
import scipy as sp
import scipy<span class="token punctuation">.</span>optimize
import datetime as dt
from scipy import linalg as sla
from scipy import spatial
from jqdata import jy

def <span class="token function">initialize</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    #用沪深 <span class="token number">300</span> 做回报基准
    <span class="token function">set_benchmark</span><span class="token punctuation">(</span><span class="token string">'000300.XSHG'</span><span class="token punctuation">)</span>
    <span class="token function">set_slippage</span><span class="token punctuation">(</span><span class="token function">FixedSlippage</span><span class="token punctuation">(</span><span class="token number">0.002</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">set_option</span><span class="token punctuation">(</span><span class="token string">'use_real_price'</span><span class="token punctuation">,</span> True<span class="token punctuation">)</span>

    # 关闭部分log
    log<span class="token punctuation">.</span><span class="token function">set_level</span><span class="token punctuation">(</span><span class="token string">'order'</span><span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">)</span>
    # 定义策略占用仓位比例
    context<span class="token punctuation">.</span>lowPEG_ratio <span class="token operator">=</span> <span class="token number">1.0</span>

    # <span class="token keyword">for</span> lowPEG algorithms
    # 正态分布概率表，标准差倍数以及置信率
    # <span class="token number">1.96</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token operator">%</span><span class="token punctuation">;</span> <span class="token number">2.06</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token operator">%</span><span class="token punctuation">;</span> <span class="token number">2.18</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token operator">%</span><span class="token punctuation">;</span> <span class="token number">2.34</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token operator">%</span><span class="token punctuation">;</span> <span class="token number">2.58</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token operator">%</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">99.9999</span><span class="token operator">%</span>
    context<span class="token punctuation">.</span>lowPEG_confidencelevel <span class="token operator">=</span> <span class="token number">1.96</span>
    context<span class="token punctuation">.</span>lowPEG_hold_periods<span class="token punctuation">,</span> context<span class="token punctuation">.</span>lowPEG_hold_cycle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">30</span>
    context<span class="token punctuation">.</span>lowPEG_stock_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    context<span class="token punctuation">.</span>lowPEG_position_price <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    g<span class="token punctuation">.</span>quantlib <span class="token operator">=</span> <span class="token function">quantlib</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token function">run_daily</span><span class="token punctuation">(</span>fun_main<span class="token punctuation">,</span> <span class="token string">'10:30'</span><span class="token punctuation">)</span>

def <span class="token function">fun_main</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>

    lowPEG_trade_ratio <span class="token operator">=</span> <span class="token function">lowPEG_algo</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> context<span class="token punctuation">.</span>lowPEG_ratio<span class="token punctuation">,</span> context<span class="token punctuation">.</span>portfolio<span class="token punctuation">.</span>portfolio_value<span class="token punctuation">)</span>
    # 调仓，执行交易
    g<span class="token punctuation">.</span>quantlib<span class="token punctuation">.</span><span class="token function">fun_do_trade</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> lowPEG_trade_ratio<span class="token punctuation">,</span> context<span class="token punctuation">.</span>lowPEG_moneyfund<span class="token punctuation">)</span>


def <span class="token function">lowPEG_algo</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> lowPEG_ratio<span class="token punctuation">,</span> portfolio_value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">''</span>'
    low PEG algorithms
    输入参数：lowPEG_ratio<span class="token punctuation">,</span> protfolio_value
    输出参数：lowPEG_trade_ratio
    自有类  <span class="token punctuation">:</span> lowPEG_lib
    调用类  <span class="token punctuation">:</span> quantlib
    <span class="token string">''</span>'

    # 引用 lib
    g<span class="token punctuation">.</span>lowPEG <span class="token operator">=</span> <span class="token function">lowPEG_lib</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    # 引用 quantlib
    g<span class="token punctuation">.</span>quantlib <span class="token operator">=</span> <span class="token function">quantlib</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    g<span class="token punctuation">.</span>lowPEG<span class="token punctuation">.</span><span class="token function">fun_initialize</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>

    recal_flag <span class="token operator">=</span> False
    <span class="token keyword">if</span> g<span class="token punctuation">.</span>lowPEG<span class="token punctuation">.</span><span class="token function">fun_needRebalance</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        recal_flag <span class="token operator">=</span> True

    # 配仓，分配持股比例
    equity_ratio <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">if</span> recal_flag<span class="token punctuation">:</span>
        context<span class="token punctuation">.</span>lowPEG_stock_list <span class="token operator">=</span> g<span class="token punctuation">.</span>lowPEG<span class="token punctuation">.</span><span class="token function">fun_get_stock_list</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
        equity_ratio<span class="token punctuation">,</span> bonds_ratio <span class="token operator">=</span> g<span class="token punctuation">.</span>lowPEG<span class="token punctuation">.</span><span class="token function">fun_assetAllocationSystem</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> context<span class="token punctuation">.</span>lowPEG_stock_list<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        equity_ratio <span class="token operator">=</span> context<span class="token punctuation">.</span>lowPEG_equity_ratio
        bonds_ratio <span class="token operator">=</span> context<span class="token punctuation">.</span>lowPEG_bonds_ratio

    context<span class="token punctuation">.</span>lowPEG_equity_ratio <span class="token operator">=</span> equity_ratio
    context<span class="token punctuation">.</span>lowPEG_bonds_ratio <span class="token operator">=</span> bonds_ratio

    # 分配头寸，配置市值
    trade_ratio <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">if</span> recal_flag<span class="token punctuation">:</span>
        trade_ratio <span class="token operator">=</span> g<span class="token punctuation">.</span>lowPEG<span class="token punctuation">.</span><span class="token function">fun_calPosition</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> equity_ratio<span class="token punctuation">,</span> bonds_ratio<span class="token punctuation">,</span> lowPEG_ratio<span class="token punctuation">,</span> portfolio_value<span class="token punctuation">)</span>

        stock_list <span class="token operator">=</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token function">get_all_securities</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'stock'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>index<span class="token punctuation">)</span>
        <span class="token keyword">for</span> stock <span class="token keyword">in</span> context<span class="token punctuation">.</span>portfolio<span class="token punctuation">.</span>positions<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> stock not <span class="token keyword">in</span> trade_ratio and stock <span class="token keyword">in</span> stock_list<span class="token punctuation">:</span>
                trade_ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        trade_ratio <span class="token operator">=</span> context<span class="token punctuation">.</span>lowPEG_trade_ratio

    context<span class="token punctuation">.</span>lowPEG_trade_ratio <span class="token operator">=</span> trade_ratio

    <span class="token keyword">return</span> trade_ratio

class <span class="token class-name">lowPEG_lib</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    def <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> _period <span class="token operator">=</span> <span class="token string">'1d'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        pass
    
    def <span class="token function">fun_initialize</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        # 定义股票池
        lowPEG_equity <span class="token operator">=</span> context<span class="token punctuation">.</span>lowPEG_stock_list

        lowPEG_moneyfund <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'511880.XSHG'</span><span class="token punctuation">]</span>

        # 上市不足 <span class="token number">60</span> 天的剔除掉
        context<span class="token punctuation">.</span>lowPEG_equity    <span class="token operator">=</span> g<span class="token punctuation">.</span>quantlib<span class="token punctuation">.</span><span class="token function">fun_delNewShare</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> lowPEG_equity<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span>
        context<span class="token punctuation">.</span>lowPEG_moneyfund <span class="token operator">=</span> g<span class="token punctuation">.</span>quantlib<span class="token punctuation">.</span><span class="token function">fun_delNewShare</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> lowPEG_moneyfund<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span>

        context<span class="token punctuation">.</span>lowPEG_hold_num <span class="token operator">=</span> <span class="token number">5</span>
        context<span class="token punctuation">.</span>lowPEG_risk_ratio <span class="token operator">=</span> <span class="token number">0.03</span> <span class="token operator">/</span> context<span class="token punctuation">.</span>lowPEG_hold_num

    def <span class="token function">fun_needRebalance</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>lowPEG_stock_list<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            context<span class="token punctuation">.</span>lowPEG_hold_periods <span class="token operator">=</span> context<span class="token punctuation">.</span>lowPEG_hold_cycle
            <span class="token keyword">return</span> True
        
        <span class="token keyword">if</span> context<span class="token punctuation">.</span>lowPEG_hold_periods <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            context<span class="token punctuation">.</span>lowPEG_hold_periods <span class="token operator">=</span> context<span class="token punctuation">.</span>lowPEG_hold_cycle
            <span class="token keyword">return</span> True
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            context<span class="token punctuation">.</span>lowPEG_hold_periods <span class="token operator">-</span><span class="token operator">=</span> <span class="token number">1</span>
            <span class="token keyword">return</span> False

    # 取得净利润增长率参数
    def <span class="token function">fun_get_inc</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> stock_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
        # 取最近的四个季度财报的日期
        def <span class="token function">__get_quarter</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token string">''</span>'
            输入 stock_list
            返回最近 n 个财报的日期
            返回每个股票最近一个财报的日期
            <span class="token string">''</span>'
            # 取最新一季度的统计日期
            q <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>indicator<span class="token punctuation">.</span>code<span class="token punctuation">,</span> indicator<span class="token punctuation">.</span>statDate
                     <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>indicator<span class="token punctuation">.</span>code<span class="token punctuation">.</span><span class="token function">in_</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
            df <span class="token operator">=</span> <span class="token function">get_fundamentals</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>

            stock_last_statDate <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            tmpDict <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">to_dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>tmpDict<span class="token punctuation">[</span><span class="token string">'statDate'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                # 取得每个股票的代码，以及最新的财报发布日
                stock_last_statDate<span class="token punctuation">[</span>tmpDict<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmpDict<span class="token punctuation">[</span><span class="token string">'statDate'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span>

            df <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token string">'statDate'</span><span class="token punctuation">,</span> ascending<span class="token operator">=</span>False<span class="token punctuation">)</span>
            # 取得最新的财报日期
            last_statDate <span class="token operator">=</span> df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>

            this_year <span class="token operator">=</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token function">str</span><span class="token punctuation">(</span>last_statDate<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            this_month <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>last_statDate<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span>

            <span class="token keyword">if</span> this_month <span class="token operator">==</span> <span class="token string">'12'</span><span class="token punctuation">:</span>
                last_quarter       <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year<span class="token punctuation">)</span>     <span class="token operator">+</span> <span class="token string">'q4'</span>
                last_two_quarter   <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year<span class="token punctuation">)</span>     <span class="token operator">+</span> <span class="token string">'q3'</span>
                last_three_quarter <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year<span class="token punctuation">)</span>     <span class="token operator">+</span> <span class="token string">'q2'</span>
                last_four_quarter  <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year<span class="token punctuation">)</span>     <span class="token operator">+</span> <span class="token string">'q1'</span>
                last_five_quarter  <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'q4'</span>

            elif this_month <span class="token operator">==</span> <span class="token string">'09'</span><span class="token punctuation">:</span>
                last_quarter       <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year<span class="token punctuation">)</span>     <span class="token operator">+</span> <span class="token string">'q3'</span>
                last_two_quarter   <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year<span class="token punctuation">)</span>     <span class="token operator">+</span> <span class="token string">'q2'</span>
                last_three_quarter <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year<span class="token punctuation">)</span>     <span class="token operator">+</span> <span class="token string">'q1'</span>
                last_four_quarter  <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'q4'</span>
                last_five_quarter  <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'q3'</span>

            elif this_month <span class="token operator">==</span> <span class="token string">'06'</span><span class="token punctuation">:</span>
                last_quarter       <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year<span class="token punctuation">)</span>     <span class="token operator">+</span> <span class="token string">'q2'</span>
                last_two_quarter   <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year<span class="token punctuation">)</span>     <span class="token operator">+</span> <span class="token string">'q1'</span>
                last_three_quarter <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'q4'</span>
                last_four_quarter  <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'q3'</span>
                last_five_quarter  <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'q2'</span>

            <span class="token keyword">else</span><span class="token punctuation">:</span>  #this_month <span class="token operator">==</span> <span class="token string">'03'</span><span class="token punctuation">:</span>
                last_quarter       <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year<span class="token punctuation">)</span>     <span class="token operator">+</span> <span class="token string">'q1'</span>
                last_two_quarter   <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'q4'</span>
                last_three_quarter <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'q3'</span>
                last_four_quarter  <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'q2'</span>
                last_five_quarter  <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span>this_year <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'q1'</span>
        
            <span class="token keyword">return</span> last_quarter<span class="token punctuation">,</span> last_two_quarter<span class="token punctuation">,</span> last_three_quarter<span class="token punctuation">,</span> last_four_quarter<span class="token punctuation">,</span> last_five_quarter<span class="token punctuation">,</span> stock_last_statDate

        # 查财报，返回指定值
        def <span class="token function">__get_fundamentals_value</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">,</span> myDate<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token string">''</span>'
            输入 stock_list<span class="token punctuation">,</span> 查询日期
            返回指定的财务数据，格式 dict
            <span class="token string">''</span>'
            q <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>indicator<span class="token punctuation">.</span>code<span class="token punctuation">,</span> indicator<span class="token punctuation">.</span>inc_net_profit_year_on_year<span class="token punctuation">,</span> indicator<span class="token punctuation">.</span>statDate
                     <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>indicator<span class="token punctuation">.</span>code<span class="token punctuation">.</span><span class="token function">in_</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">)</span><span class="token punctuation">)</span>

            df <span class="token operator">=</span> <span class="token function">get_fundamentals</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> statDate <span class="token operator">=</span> myDate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fillna</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

            tmpDict <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">to_dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            stock_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>tmpDict<span class="token punctuation">[</span><span class="token string">'statDate'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                tmpList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                tmpList<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>tmpDict<span class="token punctuation">[</span><span class="token string">'statDate'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                tmpList<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>tmpDict<span class="token punctuation">[</span><span class="token string">'inc_net_profit_year_on_year'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                stock_dict<span class="token punctuation">[</span>tmpDict<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmpList

            <span class="token keyword">return</span> stock_dict

        # 对净利润增长率进行处理
        def <span class="token function">__cal_net_profit_inc</span><span class="token punctuation">(</span>inc_list<span class="token punctuation">)</span><span class="token punctuation">:</span>

            inc <span class="token operator">=</span> inc_list

            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>inc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   # 约束在 <span class="token operator">+</span><span class="token operator">-</span> <span class="token number">100</span> 之内，避免失真
                <span class="token keyword">if</span> inc<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">:</span>
                    inc<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span>
                <span class="token keyword">if</span> inc<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">:</span>
                    inc<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">100</span>

            avg_inc <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">mean</span><span class="token punctuation">(</span>inc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            last_inc <span class="token operator">=</span> inc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            inc_std <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">std</span><span class="token punctuation">(</span>inc<span class="token punctuation">)</span>
                
            <span class="token keyword">return</span> avg_inc<span class="token punctuation">,</span> last_inc<span class="token punctuation">,</span> inc_std

        # 得到最近 n 个季度的统计时间
        last_quarter<span class="token punctuation">,</span> last_two_quarter<span class="token punctuation">,</span> last_three_quarter<span class="token punctuation">,</span> last_four_quarter<span class="token punctuation">,</span> last_five_quarter<span class="token punctuation">,</span> stock_last_statDate <span class="token operator">=</span> <span class="token function">__get_quarter</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">)</span>
    
        last_quarter_dict       <span class="token operator">=</span> <span class="token function">__get_fundamentals_value</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">,</span> last_quarter<span class="token punctuation">)</span>
        last_two_quarter_dict   <span class="token operator">=</span> <span class="token function">__get_fundamentals_value</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">,</span> last_two_quarter<span class="token punctuation">)</span>
        last_three_quarter_dict <span class="token operator">=</span> <span class="token function">__get_fundamentals_value</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">,</span> last_three_quarter<span class="token punctuation">)</span>
        last_four_quarter_dict  <span class="token operator">=</span> <span class="token function">__get_fundamentals_value</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">,</span> last_four_quarter<span class="token punctuation">)</span>
        last_five_quarter_dict  <span class="token operator">=</span> <span class="token function">__get_fundamentals_value</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">,</span> last_five_quarter<span class="token punctuation">)</span>
    
        stock_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> stock <span class="token keyword">in</span> stock_list<span class="token punctuation">:</span>
            inc_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

            <span class="token keyword">if</span> stock <span class="token keyword">in</span> stock_last_statDate<span class="token punctuation">:</span>
                <span class="token keyword">if</span> stock <span class="token keyword">in</span> last_quarter_dict<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> stock_last_statDate<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">==</span> last_quarter_dict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        inc_list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>last_quarter_dict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

                <span class="token keyword">if</span> stock <span class="token keyword">in</span> last_two_quarter_dict<span class="token punctuation">:</span>
                    inc_list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>last_two_quarter_dict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    inc_list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

                <span class="token keyword">if</span> stock <span class="token keyword">in</span> last_three_quarter_dict<span class="token punctuation">:</span>
                    inc_list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>last_three_quarter_dict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    inc_list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

                <span class="token keyword">if</span> stock <span class="token keyword">in</span> last_four_quarter_dict<span class="token punctuation">:</span>
                    inc_list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>last_four_quarter_dict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    inc_list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

                <span class="token keyword">if</span> stock <span class="token keyword">in</span> last_five_quarter_dict<span class="token punctuation">:</span>
                    inc_list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>last_five_quarter_dict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    inc_list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                inc_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>

            # 取得过去<span class="token number">4</span>个季度的平均增长，最后<span class="token number">1</span>个季度的增长，增长标准差
            avg_inc<span class="token punctuation">,</span> last_inc<span class="token punctuation">,</span> inc_std <span class="token operator">=</span> <span class="token function">__cal_net_profit_inc</span><span class="token punctuation">(</span>inc_list<span class="token punctuation">)</span>

            stock_dict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            stock_dict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'avg_inc'</span><span class="token punctuation">]</span> <span class="token operator">=</span> avg_inc
            stock_dict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'last_inc'</span><span class="token punctuation">]</span> <span class="token operator">=</span> last_inc
            stock_dict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'inc_std'</span><span class="token punctuation">]</span> <span class="token operator">=</span> inc_std

        <span class="token keyword">return</span> stock_dict

    def <span class="token function">fun_cal_stock_PEG</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> stock_list<span class="token punctuation">,</span> stock_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> not stock_list<span class="token punctuation">:</span>
            PEG <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token keyword">return</span> PEG

        q <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>valuation<span class="token punctuation">.</span>code<span class="token punctuation">,</span> valuation<span class="token punctuation">.</span>pe_ratio
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>valuation<span class="token punctuation">.</span>code<span class="token punctuation">.</span><span class="token function">in_</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        df <span class="token operator">=</span> <span class="token function">get_fundamentals</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fillna</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

        tmpDict <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">to_dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        pe_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        tmp_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>tmpDict<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            pe_dict<span class="token punctuation">[</span>tmpDict<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmpDict<span class="token punctuation">[</span><span class="token string">'pe_ratio'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span>

        # 国泰民安版本
        #df <span class="token operator">=</span> g<span class="token punctuation">.</span>quantlib<span class="token punctuation">.</span><span class="token function">fun_get_Divid_by_year</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> stock_list<span class="token punctuation">)</span>
        # 聚源版本
        statsDate <span class="token operator">=</span> context<span class="token punctuation">.</span>current_dt<span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> dt<span class="token punctuation">.</span><span class="token function">timedelta</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        df <span class="token operator">=</span> g<span class="token punctuation">.</span>quantlib<span class="token punctuation">.</span><span class="token function">fun_get_Dividend_yield</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">,</span> statsDate<span class="token punctuation">)</span>
        tmpDict <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">to_dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        stock_interest <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> stock <span class="token keyword">in</span> tmpDict<span class="token punctuation">[</span><span class="token string">'divpercent'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            stock_interest<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">=</span> tmpDict<span class="token punctuation">[</span><span class="token string">'divpercent'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>stock<span class="token punctuation">]</span>

        h <span class="token operator">=</span> <span class="token function">history</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'1d'</span><span class="token punctuation">,</span> <span class="token string">'close'</span><span class="token punctuation">,</span> stock_list<span class="token punctuation">,</span> df<span class="token operator">=</span>False<span class="token punctuation">)</span>
        PEG <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> stock <span class="token keyword">in</span> stock_list<span class="token punctuation">:</span>
            avg_inc  <span class="token operator">=</span> stock_dict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'avg_inc'</span><span class="token punctuation">]</span>
            last_inc <span class="token operator">=</span> stock_dict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'last_inc'</span><span class="token punctuation">]</span>
            inc_std  <span class="token operator">=</span> stock_dict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'inc_std'</span><span class="token punctuation">]</span>

            pe <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>            
            <span class="token keyword">if</span> stock <span class="token keyword">in</span> pe_dict<span class="token punctuation">:</span>
                pe <span class="token operator">=</span> pe_dict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span>

            interest <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">if</span> stock <span class="token keyword">in</span> stock_interest<span class="token punctuation">:</span>
                interest <span class="token operator">=</span> stock_interest<span class="token punctuation">[</span>stock<span class="token punctuation">]</span>

            PEG<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
            <span class="token string">''</span>'
            原话大概是：
            <span class="token number">1</span>、增长率 <span class="token operator">&gt;</span> <span class="token number">50</span> 的公司要小心，高增长不可持续，一旦转差就要卖掉；实现的时候，直接卖掉增长率 <span class="token operator">&gt;</span> <span class="token number">50</span> 个股票
            <span class="token number">2</span>、增长平稳，不知道该怎么表达，用了 inc_std <span class="token operator">&lt;</span> last_inc。有思路的同学请告诉我
            <span class="token string">''</span>'
            <span class="token keyword">if</span> pe <span class="token operator">&gt;</span> <span class="token number">0</span> and last_inc <span class="token operator">&lt;=</span> <span class="token number">50</span> and last_inc <span class="token operator">&gt;</span> <span class="token number">0</span> and inc_std <span class="token operator">&lt;</span> last_inc<span class="token punctuation">:</span>
                PEG<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>pe <span class="token operator">/</span> <span class="token punctuation">(</span>last_inc <span class="token operator">+</span> interest<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> PEG

    def <span class="token function">fun_get_stock_list</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        
        def <span class="token function">fun_get_stock_market_cap</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
            q <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>valuation<span class="token punctuation">.</span>code<span class="token punctuation">,</span> valuation<span class="token punctuation">.</span>market_cap
                    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>valuation<span class="token punctuation">.</span>code<span class="token punctuation">.</span><span class="token function">in_</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            df <span class="token operator">=</span> <span class="token function">get_fundamentals</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fillna</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
            tmpDict <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">to_dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            stock_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>tmpDict<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                # 取得每个股票的 market_cap
                stock_dict<span class="token punctuation">[</span>tmpDict<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmpDict<span class="token punctuation">[</span><span class="token string">'market_cap'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                
            <span class="token keyword">return</span> stock_dict
        
        today <span class="token operator">=</span> context<span class="token punctuation">.</span>current_dt
        stock_list <span class="token operator">=</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token function">get_all_securities</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'stock'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> today<span class="token punctuation">)</span><span class="token punctuation">.</span>index<span class="token punctuation">)</span>
        
        stock_list <span class="token operator">=</span> g<span class="token punctuation">.</span>quantlib<span class="token punctuation">.</span><span class="token function">unpaused</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">)</span>
        stock_list <span class="token operator">=</span> g<span class="token punctuation">.</span>quantlib<span class="token punctuation">.</span><span class="token function">fun_remove_cycle_industry</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> stock_list<span class="token punctuation">)</span>

        stock_dict <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">fun_get_inc</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> stock_list<span class="token punctuation">)</span>
        old_stocks_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> stock <span class="token keyword">in</span> context<span class="token punctuation">.</span>portfolio<span class="token punctuation">.</span>positions<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> stock <span class="token keyword">in</span> stock_list<span class="token punctuation">:</span>
                old_stocks_list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>stock<span class="token punctuation">)</span>

        stock_PEG <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">fun_cal_stock_PEG</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> stock_list<span class="token punctuation">,</span> stock_dict<span class="token punctuation">)</span>
        
        stock_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        buydict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
        <span class="token keyword">for</span> stock <span class="token keyword">in</span> stock_PEG<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> stock_PEG<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span> and stock_PEG<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                stock_list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>stock<span class="token punctuation">)</span>
                buydict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">=</span> stock_PEG<span class="token punctuation">[</span>stock<span class="token punctuation">]</span>
        cap_dict <span class="token operator">=</span> <span class="token function">fun_get_stock_market_cap</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">)</span>
        buydict <span class="token operator">=</span> <span class="token function">sorted</span><span class="token punctuation">(</span>cap_dict<span class="token punctuation">.</span><span class="token function">items</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span>lambda d<span class="token punctuation">:</span>d<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span>False<span class="token punctuation">)</span>

        buylist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        i <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> idx <span class="token keyword">in</span> buydict<span class="token punctuation">:</span>
            <span class="token keyword">if</span> i <span class="token operator">&lt;</span> context<span class="token punctuation">.</span>lowPEG_hold_num<span class="token punctuation">:</span>
                stock <span class="token operator">=</span> idx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                buylist<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>stock<span class="token punctuation">)</span> # 候选 stocks
                print stock <span class="token operator">+</span> <span class="token string">", PEG = "</span><span class="token operator">+</span> <span class="token function">str</span><span class="token punctuation">(</span>stock_PEG<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">)</span>
                i <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span>
        
        <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>buylist<span class="token punctuation">)</span> <span class="token operator">&lt;</span> context<span class="token punctuation">.</span>lowPEG_hold_num<span class="token punctuation">:</span>
            old_stocks_PEG <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">fun_cal_stock_PEG</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> old_stocks_list<span class="token punctuation">,</span> stock_dict<span class="token punctuation">)</span>
            tmpDict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            tmpList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> stock <span class="token keyword">in</span> old_stocks_PEG<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> old_stocks_PEG<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">1.0</span> and old_stocks_PEG<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    tmpDict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">=</span> old_stocks_PEG<span class="token punctuation">[</span>stock<span class="token punctuation">]</span>
            tmpDict <span class="token operator">=</span> <span class="token function">sorted</span><span class="token punctuation">(</span>tmpDict<span class="token punctuation">.</span><span class="token function">items</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span>lambda d<span class="token punctuation">:</span>d<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span>False<span class="token punctuation">)</span>
            i <span class="token operator">=</span> <span class="token function">len</span><span class="token punctuation">(</span>buylist<span class="token punctuation">)</span>
            <span class="token keyword">for</span> idx <span class="token keyword">in</span> tmpDict<span class="token punctuation">:</span>
                <span class="token keyword">if</span> i <span class="token operator">&lt;</span> context<span class="token punctuation">.</span>lowPEG_hold_num and idx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> not <span class="token keyword">in</span> buylist<span class="token punctuation">:</span>
                    buylist<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>idx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    i <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span>

        print <span class="token function">str</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" / "</span> <span class="token operator">+</span> <span class="token function">str</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>buylist<span class="token punctuation">)</span><span class="token punctuation">)</span>
        print buylist

        <span class="token keyword">return</span> buylist

    def <span class="token function">fun_assetAllocationSystem</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> buylist<span class="token punctuation">)</span><span class="token punctuation">:</span>
        def <span class="token function">__fun_getEquity_ratio</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> __stocklist<span class="token punctuation">)</span><span class="token punctuation">:</span>
            __ratio <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            # 按风险平价配仓
            <span class="token keyword">if</span> __stocklist<span class="token punctuation">:</span>
                __ratio <span class="token operator">=</span> g<span class="token punctuation">.</span>quantlib<span class="token punctuation">.</span><span class="token function">fun_calStockWeight_by_risk</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token number">2.58</span><span class="token punctuation">,</span> __stocklist<span class="token punctuation">)</span>

            <span class="token keyword">return</span> __ratio

        equity_ratio <span class="token operator">=</span> <span class="token function">__fun_getEquity_ratio</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> buylist<span class="token punctuation">)</span>
        bonds_ratio  <span class="token operator">=</span> <span class="token function">__fun_getEquity_ratio</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> context<span class="token punctuation">.</span>lowPEG_moneyfund<span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> equity_ratio<span class="token punctuation">,</span> bonds_ratio

    def <span class="token function">fun_calPosition</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> equity_ratio<span class="token punctuation">,</span> bonds_ratio<span class="token punctuation">,</span> lowPEG_ratio<span class="token punctuation">,</span> portfolio_value<span class="token punctuation">)</span><span class="token punctuation">:</span>

        #risk_ratio <span class="token operator">=</span> <span class="token function">len</span><span class="token punctuation">(</span>equity_ratio<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        risk_ratio <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> stock <span class="token keyword">in</span> equity_ratio<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> equity_ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span> <span class="token number">0</span> and stock not <span class="token keyword">in</span> context<span class="token punctuation">.</span>lowPEG_moneyfund<span class="token punctuation">:</span>
                risk_ratio <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span>
        risk_money <span class="token operator">=</span> context<span class="token punctuation">.</span>portfolio<span class="token punctuation">.</span>portfolio_value <span class="token operator">*</span> risk_ratio <span class="token operator">*</span> context<span class="token punctuation">.</span>lowPEG_ratio <span class="token operator">*</span> context<span class="token punctuation">.</span>lowPEG_risk_ratio
        maxrisk_money <span class="token operator">=</span> risk_money <span class="token operator">*</span> <span class="token number">1.7</span>

        equity_value <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">if</span> equity_ratio<span class="token punctuation">:</span>
            equity_value <span class="token operator">=</span> g<span class="token punctuation">.</span>quantlib<span class="token punctuation">.</span><span class="token function">fun_getEquity_value</span><span class="token punctuation">(</span>equity_ratio<span class="token punctuation">,</span> risk_money<span class="token punctuation">,</span> maxrisk_money<span class="token punctuation">,</span> context<span class="token punctuation">.</span>lowPEG_confidencelevel<span class="token punctuation">)</span>

        value_ratio <span class="token operator">=</span> <span class="token number">0</span>
        total_value <span class="token operator">=</span> portfolio_value <span class="token operator">*</span> lowPEG_ratio
        <span class="token keyword">if</span> equity_value <span class="token operator">&gt;</span> total_value<span class="token punctuation">:</span>
            bonds_value <span class="token operator">=</span> <span class="token number">0</span>
            value_ratio <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">*</span> lowPEG_ratio
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            value_ratio <span class="token operator">=</span> <span class="token punctuation">(</span>equity_value <span class="token operator">/</span> total_value<span class="token punctuation">)</span> <span class="token operator">*</span> lowPEG_ratio
            bonds_value <span class="token operator">=</span> total_value <span class="token operator">-</span> equity_value
        
        trade_ratio <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        equity_list <span class="token operator">=</span> equity_ratio<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> stock <span class="token keyword">in</span> equity_list<span class="token punctuation">:</span>
            <span class="token keyword">if</span> stock <span class="token keyword">in</span> trade_ratio<span class="token punctuation">:</span>
                trade_ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>equity_ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">*</span> value_ratio<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                trade_ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>equity_ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">*</span> value_ratio<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    
        <span class="token keyword">for</span> stock <span class="token keyword">in</span> bonds_ratio<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> stock <span class="token keyword">in</span> trade_ratio<span class="token punctuation">:</span>
                trade_ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bonds_ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">*</span> bonds_value <span class="token operator">/</span> total_value<span class="token punctuation">)</span> <span class="token operator">*</span> lowPEG_ratio<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                trade_ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bonds_ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">*</span> bonds_value <span class="token operator">/</span> total_value<span class="token punctuation">)</span> <span class="token operator">*</span> lowPEG_ratio<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    
        <span class="token keyword">return</span> trade_ratio

class <span class="token class-name">quantlib</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    def <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> _period <span class="token operator">=</span> <span class="token string">'1d'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        pass

    # 剔除周期性行业
    def <span class="token function">fun_remove_cycle_industry</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> stock_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cycle_industry <span class="token operator">=</span> <span class="token punctuation">[</span>#<span class="token string">'A01'</span><span class="token punctuation">,</span> #	农业 	<span class="token number">1993</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">17</span>
                          #<span class="token string">'A02'</span><span class="token punctuation">,</span> # 林业 	<span class="token number">1996</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">06</span>
                          #<span class="token string">'A03'</span><span class="token punctuation">,</span> #	畜牧业 	<span class="token number">1997</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">11</span>
                          #<span class="token string">'A04'</span><span class="token punctuation">,</span> #	渔业 	<span class="token number">1993</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">07</span>
                          #<span class="token string">'A05'</span><span class="token punctuation">,</span> #	农、林、牧、渔服务业 	<span class="token number">1997</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">30</span>
                          <span class="token string">'B06'</span><span class="token punctuation">,</span> # 煤炭开采和洗选业 	<span class="token number">1994</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>
                          <span class="token string">'B07'</span><span class="token punctuation">,</span> # 石油和天然气开采业 	<span class="token number">1996</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">28</span>
                          <span class="token string">'B08'</span><span class="token punctuation">,</span> # 黑色金属矿采选业 	<span class="token number">1997</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">08</span>
                          <span class="token string">'B09'</span><span class="token punctuation">,</span> # 有色金属矿采选业 	<span class="token number">1996</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">20</span>
                          <span class="token string">'B11'</span><span class="token punctuation">,</span> # 开采辅助活动 	<span class="token number">2002</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">05</span>
                          #<span class="token string">'C13'</span><span class="token punctuation">,</span> #	农副食品加工业 	<span class="token number">1993</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">15</span>
                          #C14 	食品制造业 	<span class="token number">1994</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">18</span>
                          #C15 	酒、饮料和精制茶制造业 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">12</span>
                          #C17 	纺织业 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">16</span>
                          #C18 	纺织服装、服饰业 	<span class="token number">1993</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>
                          #C19 	皮革、毛皮、羽毛及其制品和制鞋业 	<span class="token number">1994</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">04</span>
                          #C20 	木材加工及木、竹、藤、棕、草制品业 	<span class="token number">2005</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">10</span>
                          #C21 	家具制造业 	<span class="token number">1996</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">25</span>
                          #C22 	造纸及纸制品业 	<span class="token number">1993</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">12</span>
                          #C23 	印刷和记录媒介复制业 	<span class="token number">1994</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">24</span>
                          #C24 	文教、工美、体育和娱乐用品制造业 	<span class="token number">2007</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">10</span>
                          <span class="token string">'C25'</span><span class="token punctuation">,</span> # 石油加工、炼焦及核燃料加工业 	<span class="token number">1993</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">25</span>
                          <span class="token string">'C26'</span><span class="token punctuation">,</span> # 化学原料及化学制品制造业 	<span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">19</span>
                          #C27 	医药制造业 	<span class="token number">1993</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">29</span>
                          <span class="token string">'C28'</span><span class="token punctuation">,</span> # 化学纤维制造业 	<span class="token number">1993</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">28</span>
                          <span class="token string">'C29'</span><span class="token punctuation">,</span> # 橡胶和塑料制品业 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">28</span>
                          <span class="token string">'C30'</span><span class="token punctuation">,</span> # 非金属矿物制品业 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">28</span>
                          <span class="token string">'C31'</span><span class="token punctuation">,</span> # 黑色金属冶炼及压延加工业 	<span class="token number">1994</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>
                          <span class="token string">'C32'</span><span class="token punctuation">,</span> # 有色金属冶炼和压延加工业 	<span class="token number">1996</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">15</span>
                          <span class="token string">'C33'</span><span class="token punctuation">,</span> # 金属制品业 	<span class="token number">1993</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">30</span>
                          <span class="token string">'C34'</span><span class="token punctuation">,</span> # 通用设备制造业 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">27</span>
                          <span class="token string">'C35'</span><span class="token punctuation">,</span> # 专用设备制造业 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">01</span>
                          <span class="token string">'C36'</span><span class="token punctuation">,</span> # 汽车制造业 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">24</span>
                          <span class="token string">'C37'</span><span class="token punctuation">,</span> # 铁路、船舶、航空航天和其它运输设备制造业 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">31</span>
                          <span class="token string">'C38'</span><span class="token punctuation">,</span> # 电气机械及器材制造业 	<span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">19</span>
                          #C39 	计算机、通信和其他电子设备制造业 	<span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">19</span>
                          #C40 	仪器仪表制造业 	<span class="token number">1993</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">17</span>
                          <span class="token string">'C41'</span><span class="token punctuation">,</span> # 其他制造业 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">14</span>
                          #C42 	废弃资源综合利用业 	<span class="token number">2012</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">26</span>
                          <span class="token string">'D44'</span><span class="token punctuation">,</span> # 电力、热力生产和供应业 	<span class="token number">1993</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span>
                          #D45 	燃气生产和供应业 	<span class="token number">2000</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">11</span>
                          #D46 	水的生产和供应业 	<span class="token number">1994</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">24</span>
                          <span class="token string">'E47'</span><span class="token punctuation">,</span> # 房屋建筑业 	<span class="token number">1993</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">29</span>
                          <span class="token string">'E48'</span><span class="token punctuation">,</span> # 土木工程建筑业 	<span class="token number">1994</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">28</span>
                          <span class="token string">'E50'</span><span class="token punctuation">,</span> # 建筑装饰和其他建筑业 	<span class="token number">1997</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">22</span>
                          #F51 	批发业 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">06</span>
                          #F52 	零售业 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">02</span>
                          <span class="token string">'G53'</span><span class="token punctuation">,</span> # 铁路运输业 	<span class="token number">1998</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">11</span>
                          <span class="token string">'G54'</span><span class="token punctuation">,</span> # 道路运输业 	<span class="token number">1991</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">14</span>
                          <span class="token string">'G55'</span><span class="token punctuation">,</span> # 水上运输业 	<span class="token number">1993</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">19</span>
                          <span class="token string">'G56'</span><span class="token punctuation">,</span> # 航空运输业 	<span class="token number">1997</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span>
                          <span class="token string">'G58'</span><span class="token punctuation">,</span> # 装卸搬运和运输代理业 	<span class="token number">1993</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">05</span>
                          #G59 	仓储业 	<span class="token number">1996</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">14</span>
                          #H61 	住宿业 	<span class="token number">1993</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">18</span>
                          #H62 	餐饮业 	<span class="token number">1997</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">30</span>
                          #I63 	电信、广播电视和卫星传输服务 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">02</span>
                          #I64 	互联网和相关服务 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">07</span>
                          #I65 	软件和信息技术服务业 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>
                          <span class="token string">'J66'</span><span class="token punctuation">,</span> # 货币金融服务 	<span class="token number">1991</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">03</span>
                          <span class="token string">'J67'</span><span class="token punctuation">,</span> # 资本市场服务 	<span class="token number">1994</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">10</span>
                          <span class="token string">'J68'</span><span class="token punctuation">,</span> # 保险业 	<span class="token number">2007</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">09</span>
                          <span class="token string">'J69'</span><span class="token punctuation">,</span> # 其他金融业 	<span class="token number">2012</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">26</span>
                          <span class="token string">'K70'</span><span class="token punctuation">,</span> # 房地产业 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">13</span>
                          #L71 	租赁业 	<span class="token number">1997</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">30</span>
                          #L72 	商务服务业 	<span class="token number">1996</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">29</span>
                          #M73 	研究和试验发展 	<span class="token number">2012</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">26</span>
                          <span class="token string">'M74'</span><span class="token punctuation">,</span> # 专业技术服务业 	<span class="token number">2007</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">15</span>
                          #N77 	生态保护和环境治理业 	<span class="token number">2012</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">26</span>
                          #N78 	公共设施管理业 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">07</span>
                          #P82 	教育 	<span class="token number">2012</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">26</span>
                          #Q83 	卫生 	<span class="token number">2007</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">05</span>
                          #R85 	新闻和出版业 	<span class="token number">1992</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">08</span>
                          #R86 	广播、电视、电影和影视录音制作业 	<span class="token number">1994</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">24</span>
                          #R87 	文化艺术业 	<span class="token number">2012</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">26</span>
                          #S90 	综合 	<span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">10</span>
                          <span class="token punctuation">]</span>
        today <span class="token operator">=</span> context<span class="token punctuation">.</span>current_dt
        <span class="token keyword">for</span> industry <span class="token keyword">in</span> cycle_industry<span class="token punctuation">:</span>
            stocks <span class="token operator">=</span> <span class="token function">get_industry_stocks</span><span class="token punctuation">(</span>industry<span class="token punctuation">,</span> today<span class="token punctuation">)</span>
            stock_list <span class="token operator">=</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token function">set</span><span class="token punctuation">(</span>stock_list<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">difference</span><span class="token punctuation">(</span><span class="token function">set</span><span class="token punctuation">(</span>stocks<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
        <span class="token keyword">return</span> stock_list

    def <span class="token function">fun_do_trade</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> trade_ratio<span class="token punctuation">,</span> moneyfund<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
        def <span class="token function">__fun_tradeStock</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> stock<span class="token punctuation">,</span> ratio<span class="token punctuation">)</span><span class="token punctuation">:</span>
            total_value <span class="token operator">=</span> context<span class="token punctuation">.</span>portfolio<span class="token punctuation">.</span>portfolio_value
            <span class="token keyword">if</span> stock <span class="token keyword">in</span> moneyfund<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span><span class="token function">fun_tradeBond</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> stock<span class="token punctuation">,</span> total_value <span class="token operator">*</span> ratio<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                curPrice <span class="token operator">=</span> <span class="token function">history</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'1d'</span><span class="token punctuation">,</span> <span class="token string">'close'</span><span class="token punctuation">,</span> stock<span class="token punctuation">,</span> df<span class="token operator">=</span>False<span class="token punctuation">)</span><span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
                curValue <span class="token operator">=</span> context<span class="token punctuation">.</span>portfolio<span class="token punctuation">.</span>positions<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">.</span>total_amount <span class="token operator">*</span> curPrice
                Quota <span class="token operator">=</span> total_value <span class="token operator">*</span> ratio
                <span class="token keyword">if</span> Quota<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token function">abs</span><span class="token punctuation">(</span>Quota <span class="token operator">-</span> curValue<span class="token punctuation">)</span> <span class="token operator">/</span> Quota <span class="token operator">&gt;=</span> <span class="token number">0.25</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> Quota <span class="token operator">&gt;</span> curValue<span class="token punctuation">:</span>
                            cash <span class="token operator">=</span> context<span class="token punctuation">.</span>portfolio<span class="token punctuation">.</span>cash
                            <span class="token keyword">if</span> cash <span class="token operator">&gt;=</span> Quota <span class="token operator">*</span> <span class="token number">0.25</span><span class="token punctuation">:</span>
                                self<span class="token punctuation">.</span><span class="token function">fun_trade</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> stock<span class="token punctuation">,</span> Quota<span class="token punctuation">)</span>
                        <span class="token keyword">else</span><span class="token punctuation">:</span>
                            self<span class="token punctuation">.</span><span class="token function">fun_trade</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> stock<span class="token punctuation">,</span> Quota<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span><span class="token function">fun_trade</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> stock<span class="token punctuation">,</span> Quota<span class="token punctuation">)</span>
    
        trade_list <span class="token operator">=</span> trade_ratio<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
        myholdstock <span class="token operator">=</span> context<span class="token punctuation">.</span>portfolio<span class="token punctuation">.</span>positions<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        total_value <span class="token operator">=</span> context<span class="token punctuation">.</span>portfolio<span class="token punctuation">.</span>portfolio_value
    
        # 已有仓位
        holdDict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        h <span class="token operator">=</span> <span class="token function">history</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'1d'</span><span class="token punctuation">,</span> <span class="token string">'close'</span><span class="token punctuation">,</span> myholdstock<span class="token punctuation">,</span> df<span class="token operator">=</span>False<span class="token punctuation">)</span>
        <span class="token keyword">for</span> stock <span class="token keyword">in</span> myholdstock<span class="token punctuation">:</span>
            tmpW <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>portfolio<span class="token punctuation">.</span>positions<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">.</span>total_amount <span class="token operator">*</span> h<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span>total_value<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
            holdDict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">float</span><span class="token punctuation">(</span>tmpW<span class="token punctuation">)</span>
    
        # 对已有仓位做排序
        tmpDict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> stock <span class="token keyword">in</span> holdDict<span class="token punctuation">:</span>
            <span class="token keyword">if</span> stock <span class="token keyword">in</span> trade_ratio<span class="token punctuation">:</span>
                tmpDict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>trade_ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">-</span> holdDict<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        tradeOrder <span class="token operator">=</span> <span class="token function">sorted</span><span class="token punctuation">(</span>tmpDict<span class="token punctuation">.</span><span class="token function">items</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span>lambda d<span class="token punctuation">:</span>d<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span>False<span class="token punctuation">)</span>
    
        _tmplist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> idx <span class="token keyword">in</span> tradeOrder<span class="token punctuation">:</span>
            stock <span class="token operator">=</span> idx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token function">__fun_tradeStock</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> stock<span class="token punctuation">,</span> trade_ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">)</span>
            _tmplist<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>stock<span class="token punctuation">)</span>
    
        # 交易其他股票
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>trade_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            stock <span class="token operator">=</span> trade_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>_tmplist<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">:</span>
                <span class="token keyword">if</span> stock not <span class="token keyword">in</span> _tmplist<span class="token punctuation">:</span>
                    <span class="token function">__fun_tradeStock</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> stock<span class="token punctuation">,</span> trade_ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token function">__fun_tradeStock</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> stock<span class="token punctuation">,</span> trade_ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">)</span>

    def <span class="token function">fun_getEquity_value</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> equity_ratio<span class="token punctuation">,</span> risk_money<span class="token punctuation">,</span> maxrisk_money<span class="token punctuation">,</span> confidence_ratio<span class="token punctuation">)</span><span class="token punctuation">:</span>
        def <span class="token function">__fun_getdailyreturn</span><span class="token punctuation">(</span>stock<span class="token punctuation">,</span> freq<span class="token punctuation">,</span> lag<span class="token punctuation">)</span><span class="token punctuation">:</span>
            hStocks <span class="token operator">=</span> <span class="token function">history</span><span class="token punctuation">(</span>lag<span class="token punctuation">,</span> freq<span class="token punctuation">,</span> <span class="token string">'close'</span><span class="token punctuation">,</span> stock<span class="token punctuation">,</span> df<span class="token operator">=</span>True<span class="token punctuation">)</span>
            dailyReturns <span class="token operator">=</span> hStocks<span class="token punctuation">.</span><span class="token function">resample</span><span class="token punctuation">(</span><span class="token string">'D'</span><span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'last'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pct_change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fillna</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> method<span class="token operator">=</span>None<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values
            #dailyReturns <span class="token operator">=</span> hStocks<span class="token punctuation">.</span><span class="token function">pct_change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fillna</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> method<span class="token operator">=</span>None<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values

            <span class="token keyword">return</span> dailyReturns

        def <span class="token function">__fun_get_portfolio_dailyreturn</span><span class="token punctuation">(</span>ratio<span class="token punctuation">,</span> freq<span class="token punctuation">,</span> lag<span class="token punctuation">)</span><span class="token punctuation">:</span>
            __portfolio_dailyreturn <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> stock <span class="token keyword">in</span> ratio<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    __dailyReturns <span class="token operator">=</span> <span class="token function">__fun_getdailyreturn</span><span class="token punctuation">(</span>stock<span class="token punctuation">,</span> freq<span class="token punctuation">,</span> lag<span class="token punctuation">)</span>
                    __tmplist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>__dailyReturns<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        __tmplist<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>__dailyReturns<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> __portfolio_dailyreturn<span class="token punctuation">:</span>
                        __tmplistB <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>__portfolio_dailyreturn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            __tmplistB<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>__portfolio_dailyreturn<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>__tmplist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                        __portfolio_dailyreturn <span class="token operator">=</span> __tmplistB
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        __portfolio_dailyreturn <span class="token operator">=</span> __tmplist
    
            <span class="token keyword">return</span> __portfolio_dailyreturn
    
        def <span class="token function">__fun_get_portfolio_ES</span><span class="token punctuation">(</span>ratio<span class="token punctuation">,</span> freq<span class="token punctuation">,</span> lag<span class="token punctuation">,</span> confidencelevel<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> confidencelevel <span class="token operator">==</span> <span class="token number">1.96</span><span class="token punctuation">:</span>
                a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">0.95</span><span class="token punctuation">)</span>
            elif confidencelevel <span class="token operator">==</span> <span class="token number">2.06</span><span class="token punctuation">:</span>
                a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">0.96</span><span class="token punctuation">)</span>
            elif confidencelevel <span class="token operator">==</span> <span class="token number">2.18</span><span class="token punctuation">:</span>
                a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">0.97</span><span class="token punctuation">)</span>
            elif confidencelevel <span class="token operator">==</span> <span class="token number">2.34</span><span class="token punctuation">:</span>
                a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">0.98</span><span class="token punctuation">)</span>
            elif confidencelevel <span class="token operator">==</span> <span class="token number">2.58</span><span class="token punctuation">:</span>
                a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">0.99</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">0.95</span><span class="token punctuation">)</span>
            dailyReturns <span class="token operator">=</span> <span class="token function">__fun_get_portfolio_dailyreturn</span><span class="token punctuation">(</span>ratio<span class="token punctuation">,</span> freq<span class="token punctuation">,</span> lag<span class="token punctuation">)</span>
            dailyReturns_sort <span class="token operator">=</span>  <span class="token function">sorted</span><span class="token punctuation">(</span>dailyReturns<span class="token punctuation">)</span>
    
            count <span class="token operator">=</span> <span class="token number">0</span>
            sum_value <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>dailyReturns_sort<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span>lag <span class="token operator">*</span> a<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    sum_value <span class="token operator">+</span><span class="token operator">=</span> dailyReturns_sort<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                    count <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span>
            <span class="token keyword">if</span> count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                ES <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                ES <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>sum_value <span class="token operator">/</span> <span class="token punctuation">(</span>lag <span class="token operator">*</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token keyword">return</span> ES

        def <span class="token function">__fun_get_portfolio_VaR</span><span class="token punctuation">(</span>ratio<span class="token punctuation">,</span> freq<span class="token punctuation">,</span> lag<span class="token punctuation">,</span> confidencelevel<span class="token punctuation">)</span><span class="token punctuation">:</span>
            __dailyReturns <span class="token operator">=</span> <span class="token function">__fun_get_portfolio_dailyreturn</span><span class="token punctuation">(</span>ratio<span class="token punctuation">,</span> freq<span class="token punctuation">,</span> lag<span class="token punctuation">)</span>
            __portfolio_VaR <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">*</span> confidencelevel <span class="token operator">*</span> np<span class="token punctuation">.</span><span class="token function">std</span><span class="token punctuation">(</span>__dailyReturns<span class="token punctuation">)</span>

            <span class="token keyword">return</span> __portfolio_VaR

        # 每元组合资产的 VaR
        __portfolio_VaR <span class="token operator">=</span> <span class="token function">__fun_get_portfolio_VaR</span><span class="token punctuation">(</span>equity_ratio<span class="token punctuation">,</span> <span class="token string">'1d'</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> confidence_ratio<span class="token punctuation">)</span>

        __equity_value_VaR <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">if</span> __portfolio_VaR<span class="token punctuation">:</span>
            __equity_value_VaR <span class="token operator">=</span> risk_money <span class="token operator">/</span> __portfolio_VaR

        __portfolio_ES <span class="token operator">=</span> <span class="token function">__fun_get_portfolio_ES</span><span class="token punctuation">(</span>equity_ratio<span class="token punctuation">,</span> <span class="token string">'1d'</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> confidence_ratio<span class="token punctuation">)</span>

        __equity_value_ES <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">if</span> __portfolio_ES<span class="token punctuation">:</span>
            __equity_value_ES <span class="token operator">=</span> maxrisk_money <span class="token operator">/</span> __portfolio_ES

        <span class="token keyword">if</span> __equity_value_VaR <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            equity_value <span class="token operator">=</span> __equity_value_ES
        elif __equity_value_ES <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            equity_value <span class="token operator">=</span> __equity_value_VaR
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            equity_value <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>__equity_value_VaR<span class="token punctuation">,</span> __equity_value_ES<span class="token punctuation">)</span>

        <span class="token keyword">return</span> equity_value

    def <span class="token function">fun_get_Dividend_yield</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> stocks<span class="token punctuation">,</span> statsDate<span class="token punctuation">)</span><span class="token punctuation">:</span>
        # 按照派息日计算，计算过去 <span class="token number">12</span>个月的派息率<span class="token punctuation">(</span>TTM<span class="token punctuation">)</span>
        start_date <span class="token operator">=</span> statsDate <span class="token operator">-</span> dt<span class="token punctuation">.</span><span class="token function">timedelta</span><span class="token punctuation">(</span><span class="token number">365</span><span class="token punctuation">)</span>
        end_date <span class="token operator">=</span> statsDate
        year <span class="token operator">=</span> statsDate<span class="token punctuation">.</span>year
        #将当前股票池转换为聚源的<span class="token number">6</span>位股票池
        stocks_symbol<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> s <span class="token keyword">in</span> stocks<span class="token punctuation">:</span>
            stocks_symbol<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        #查找聚源的内部编码
        df_code <span class="token operator">=</span> jy<span class="token punctuation">.</span><span class="token function">run_query</span><span class="token punctuation">(</span><span class="token function">query</span><span class="token punctuation">(</span>
                jy<span class="token punctuation">.</span>SecuMain<span class="token punctuation">.</span>InnerCode<span class="token punctuation">,</span>       #证券内部编码
                jy<span class="token punctuation">.</span>SecuMain<span class="token punctuation">.</span>SecuCode         #证券代码
            <span class="token punctuation">)</span><span class="token punctuation">)</span>
        df_code <span class="token operator">=</span> df_code<span class="token punctuation">[</span>df_code<span class="token punctuation">.</span>SecuCode<span class="token punctuation">.</span><span class="token function">isin</span><span class="token punctuation">(</span>stocks_symbol<span class="token punctuation">)</span><span class="token punctuation">]</span>
        list_InnerCode <span class="token operator">=</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token function">list</span><span class="token punctuation">(</span>df_code<span class="token punctuation">[</span><span class="token string">'InnerCode'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        # 按派息日，查找过去<span class="token number">12</span>个月的分红记录
        #查找有分红的（受派息日约束）；
        df <span class="token operator">=</span> jy<span class="token punctuation">.</span><span class="token function">run_query</span><span class="token punctuation">(</span><span class="token function">query</span><span class="token punctuation">(</span>
                jy<span class="token punctuation">.</span>LC_Dividend<span class="token punctuation">.</span>InnerCode<span class="token punctuation">,</span>   #证券内部编码
                jy<span class="token punctuation">.</span>LC_Dividend<span class="token punctuation">.</span>CashDiviRMB<span class="token punctuation">,</span> #派现<span class="token punctuation">(</span>含税<span class="token operator">/</span>人民币元<span class="token punctuation">)</span>（<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>说明文档没说明分红单位是每股，还是每十股）
                jy<span class="token punctuation">.</span>LC_Dividend<span class="token punctuation">.</span>DiviBaseBeforeChange<span class="token punctuation">,</span> #变更前分红股本基数<span class="token punctuation">(</span>股<span class="token punctuation">)</span>（<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>又是不提单位）
            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>
                jy<span class="token punctuation">.</span>LC_Dividend<span class="token punctuation">.</span>ToAccountDate <span class="token operator">&lt;=</span> end_date<span class="token punctuation">,</span>
                jy<span class="token punctuation">.</span>LC_Dividend<span class="token punctuation">.</span>ToAccountDate <span class="token operator">&gt;=</span> start_date<span class="token punctuation">,</span>
                jy<span class="token punctuation">.</span>LC_Dividend<span class="token punctuation">.</span>IfDividend <span class="token operator">==</span> <span class="token number">1</span>      #不考虑特殊分红和其他分红
            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fillna</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> method<span class="token operator">=</span>None<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

        df <span class="token operator">=</span> df<span class="token punctuation">[</span>df<span class="token punctuation">.</span>InnerCode<span class="token punctuation">.</span><span class="token function">isin</span><span class="token punctuation">(</span>list_InnerCode<span class="token punctuation">)</span><span class="token punctuation">]</span>
        df <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">reset_index</span><span class="token punctuation">(</span>drop <span class="token operator">=</span> True<span class="token punctuation">)</span>

        df<span class="token punctuation">.</span>index <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'InnerCode'</span><span class="token punctuation">]</span>
        df_code <span class="token operator">=</span> df_code<span class="token punctuation">[</span>df_code<span class="token punctuation">.</span>InnerCode<span class="token punctuation">.</span><span class="token function">isin</span><span class="token punctuation">(</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token function">list</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'InnerCode'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        df <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'InnerCode'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        df_code<span class="token punctuation">.</span>index <span class="token operator">=</span> df_code<span class="token punctuation">[</span><span class="token string">'InnerCode'</span><span class="token punctuation">]</span>
        df <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span>df_code<span class="token punctuation">]</span><span class="token punctuation">)</span>

        df<span class="token punctuation">[</span><span class="token string">'SecuCode'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">map</span><span class="token punctuation">(</span>normalize_code<span class="token punctuation">,</span><span class="token function">list</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'SecuCode'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        # 获取最新股本
        q <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>valuation<span class="token punctuation">.</span>code<span class="token punctuation">,</span> valuation<span class="token punctuation">.</span>capitalization<span class="token punctuation">)</span>
        df2 <span class="token operator">=</span> <span class="token function">get_fundamentals</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fillna</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

        df2 <span class="token operator">=</span> df2<span class="token punctuation">[</span>df2<span class="token punctuation">.</span>code<span class="token punctuation">.</span><span class="token function">isin</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>SecuCode<span class="token punctuation">)</span><span class="token punctuation">]</span>
        df2<span class="token punctuation">[</span><span class="token string">'SecuCode'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df2<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span>
        df2 <span class="token operator">=</span> df2<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

        # 合并成一个 dataframe
        df <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>df2<span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'SecuCode'</span><span class="token punctuation">)</span>
        df<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token function">list</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'SecuCode'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        df <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'SecuCode'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

        # 转换成 float
        df<span class="token punctuation">[</span><span class="token string">'DiviBaseBeforeChange'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>float<span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">'DiviBaseBeforeChange'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        # 计算股份比值
        # <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> 因为聚源的 DiviBaseBeforeChange 数据全数为 <span class="token number">0</span>，也就是没有记录分红时的股份基数，所以暂时默认都是 <span class="token number">1.0</span>
        # 实际市场里，因为送股<span class="token operator">/</span>配股转股的缘故，分红时的股份基数，往往会与当下的股份不一致
        #df<span class="token punctuation">[</span><span class="token string">'CAP_RATIO'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'DiviBaseBeforeChange'</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'capitalization'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">)</span>
        df<span class="token punctuation">[</span><span class="token string">'CAP_RATIO'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0</span>

        df<span class="token punctuation">[</span><span class="token string">'CashDiviRMB'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>float<span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">'CashDiviRMB'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        # 计算相对于目前股份而言的分红额度
        df<span class="token punctuation">[</span><span class="token string">'CashDiviRMB'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'CashDiviRMB'</span><span class="token punctuation">]</span> <span class="token operator">*</span> df<span class="token punctuation">[</span><span class="token string">'CAP_RATIO'</span><span class="token punctuation">]</span>

        df <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'DiviBaseBeforeChange'</span><span class="token punctuation">,</span><span class="token string">'capitalization'</span><span class="token punctuation">,</span><span class="token string">'CAP_RATIO'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        
        #接下来这一步是考虑多次分红的股票，因此需要累加股票的多次分红
        df <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">groupby</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        #得到当前股价
        Price<span class="token operator">=</span><span class="token function">history</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> unit<span class="token operator">=</span><span class="token string">'1d'</span><span class="token punctuation">,</span> field<span class="token operator">=</span><span class="token string">'close'</span><span class="token punctuation">,</span> security_list<span class="token operator">=</span><span class="token function">list</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span> df<span class="token operator">=</span>True<span class="token punctuation">,</span> skip_paused<span class="token operator">=</span>False<span class="token punctuation">,</span> fq<span class="token operator">=</span><span class="token string">'pre'</span><span class="token punctuation">)</span>
        Price<span class="token operator">=</span>Price<span class="token punctuation">.</span>T
        
        df<span class="token punctuation">[</span><span class="token string">'pre_close'</span><span class="token punctuation">]</span><span class="token operator">=</span>Price
        #计算股息率 <span class="token operator">=</span> 股息<span class="token operator">/</span>股票价格，<span class="token operator">*</span> <span class="token number">10</span> 是因为取到的是每 <span class="token number">10</span> 股分红
        df<span class="token punctuation">[</span><span class="token string">'divpercent'</span><span class="token punctuation">]</span><span class="token operator">=</span>df<span class="token punctuation">[</span><span class="token string">'CashDiviRMB'</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'pre_close'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span>
        df <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'pre_close'</span><span class="token punctuation">,</span> <span class="token string">'CashDiviRMB'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

        df <span class="token operator">=</span> df<span class="token punctuation">[</span>df<span class="token punctuation">.</span>divpercent <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span>
        #print df

        <span class="token keyword">return</span> df

    def <span class="token function">fun_get_Divid_by_year</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> stocks<span class="token punctuation">)</span><span class="token punctuation">:</span>
        year <span class="token operator">=</span> context<span class="token punctuation">.</span>current_dt<span class="token punctuation">.</span>year <span class="token operator">-</span> <span class="token number">1</span>
        #将当前股票池转换为国泰安的<span class="token number">6</span>位股票池
        stocks_symbol<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> s <span class="token keyword">in</span> stocks<span class="token punctuation">:</span>
            stocks_symbol<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        df <span class="token operator">=</span> gta<span class="token punctuation">.</span><span class="token function">run_query</span><span class="token punctuation">(</span><span class="token function">query</span><span class="token punctuation">(</span>
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>SYMBOL<span class="token punctuation">,</span>                # 股票代码
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>DECLAREDATE<span class="token punctuation">,</span>           # 分红消息的时间
            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>ISDIVIDEND <span class="token operator">==</span> <span class="token string">'Y'</span><span class="token punctuation">,</span>     #有分红的股票
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>DIVDENDYEAR <span class="token operator">==</span> year<span class="token punctuation">,</span>
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>TERMCODE <span class="token operator">==</span> <span class="token string">'P2702'</span><span class="token punctuation">,</span>   # 年度分红
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>SYMBOL<span class="token punctuation">.</span><span class="token function">in_</span><span class="token punctuation">(</span>stocks_symbol<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fillna</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> method<span class="token operator">=</span>None<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        # 转换时间格式
        df<span class="token punctuation">[</span><span class="token string">'pubtime'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>lambda x<span class="token punctuation">:</span> <span class="token function">int</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>df<span class="token punctuation">[</span><span class="token string">'DECLAREDATE'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        # 取得当前时间
        currenttime  <span class="token operator">=</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token function">str</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>current_dt<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token function">str</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>current_dt<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token function">str</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>current_dt<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        # 选择在当前时间能看到的记录
        df <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>pubtime <span class="token operator">&lt;</span> currenttime<span class="token punctuation">)</span><span class="token punctuation">]</span>
        # 得到目前看起来，有上一年度年度分红的股票
        stocks_symbol_this_year <span class="token operator">=</span> <span class="token function">list</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'SYMBOL'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        # 得到目前看起来，上一年度没有年度分红的股票
        stocks_symbol_past_year <span class="token operator">=</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token function">set</span><span class="token punctuation">(</span>stocks_symbol<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">set</span><span class="token punctuation">(</span>stocks_symbol_this_year<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        # 查有上一年度年度分红的
        df1 <span class="token operator">=</span> gta<span class="token punctuation">.</span><span class="token function">run_query</span><span class="token punctuation">(</span><span class="token function">query</span><span class="token punctuation">(</span>
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>SYMBOL<span class="token punctuation">,</span>                # 股票代码
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>DIVIDENTBT<span class="token punctuation">,</span>            # 股票分红
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>DECLAREDATE<span class="token punctuation">,</span>           # 分红消息的时间
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>DISTRIBUTIONBASESHARES # 分红时的股本基数
            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>ISDIVIDEND <span class="token operator">==</span> <span class="token string">'Y'</span><span class="token punctuation">,</span>     #有分红的股票
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>DIVDENDYEAR <span class="token operator">==</span> year<span class="token punctuation">,</span>
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>SYMBOL<span class="token punctuation">.</span><span class="token function">in_</span><span class="token punctuation">(</span>stocks_symbol_this_year<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fillna</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> method<span class="token operator">=</span>None<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

        df1<span class="token punctuation">[</span><span class="token string">'pubtime'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>lambda x<span class="token punctuation">:</span> <span class="token function">int</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>df1<span class="token punctuation">[</span><span class="token string">'DECLAREDATE'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        currenttime  <span class="token operator">=</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token function">str</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>current_dt<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token function">str</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>current_dt<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token function">str</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>current_dt<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        df1 <span class="token operator">=</span> df1<span class="token punctuation">[</span><span class="token punctuation">(</span>df1<span class="token punctuation">.</span>pubtime <span class="token operator">&lt;</span> currenttime<span class="token punctuation">)</span><span class="token punctuation">]</span>

        # 求上上年的年度分红
        df2 <span class="token operator">=</span> gta<span class="token punctuation">.</span><span class="token function">run_query</span><span class="token punctuation">(</span><span class="token function">query</span><span class="token punctuation">(</span>
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>SYMBOL<span class="token punctuation">,</span>                # 股票代码
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>DIVIDENTBT<span class="token punctuation">,</span>            # 股票分红
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>DECLAREDATE<span class="token punctuation">,</span>           # 分红消息的时间
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>DISTRIBUTIONBASESHARES # 分红时的股本基数
            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>ISDIVIDEND <span class="token operator">==</span> <span class="token string">'Y'</span><span class="token punctuation">,</span>     #有分红的股票
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>DIVDENDYEAR <span class="token operator">==</span> <span class="token punctuation">(</span>year <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                gta<span class="token punctuation">.</span>STK_DIVIDEND<span class="token punctuation">.</span>SYMBOL<span class="token punctuation">.</span><span class="token function">in_</span><span class="token punctuation">(</span>stocks_symbol_past_year<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fillna</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> method<span class="token operator">=</span>None<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        
        df2<span class="token punctuation">[</span><span class="token string">'pubtime'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>lambda x<span class="token punctuation">:</span> <span class="token function">int</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>df2<span class="token punctuation">[</span><span class="token string">'DECLAREDATE'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        currenttime  <span class="token operator">=</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token function">str</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>current_dt<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token function">str</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>current_dt<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token function">str</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>current_dt<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        df2 <span class="token operator">=</span> df2<span class="token punctuation">[</span><span class="token punctuation">(</span>df2<span class="token punctuation">.</span>pubtime <span class="token operator">&lt;</span> currenttime<span class="token punctuation">)</span><span class="token punctuation">]</span>
        
        df<span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">(</span>df2<span class="token punctuation">,</span>df1<span class="token punctuation">)</span><span class="token punctuation">)</span>

        df<span class="token punctuation">[</span><span class="token string">'SYMBOL'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">map</span><span class="token punctuation">(</span>normalize_code<span class="token punctuation">,</span><span class="token function">list</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'SYMBOL'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        df<span class="token punctuation">.</span>index<span class="token operator">=</span><span class="token function">list</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'SYMBOL'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        # 获取最新股本
        q <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>valuation<span class="token punctuation">.</span>code<span class="token punctuation">,</span> valuation<span class="token punctuation">.</span>capitalization
                <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>valuation<span class="token punctuation">.</span>code<span class="token punctuation">.</span><span class="token function">in_</span><span class="token punctuation">(</span><span class="token function">list</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        df3 <span class="token operator">=</span> <span class="token function">get_fundamentals</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fillna</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        df3<span class="token punctuation">[</span><span class="token string">'SYMBOL'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df3<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span>
        df3 <span class="token operator">=</span> df3<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

        # 合并成一个 dataframe
        df <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>df3<span class="token punctuation">,</span>on<span class="token operator">=</span><span class="token string">'SYMBOL'</span><span class="token punctuation">)</span>
        df<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token function">list</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'SYMBOL'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        # 转换成 float
        df<span class="token punctuation">[</span><span class="token string">'DISTRIBUTIONBASESHARES'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>float<span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">'DISTRIBUTIONBASESHARES'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        # 计算股份比值
        df<span class="token punctuation">[</span><span class="token string">'CAP_RATIO'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'DISTRIBUTIONBASESHARES'</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'capitalization'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">)</span>
        
        df<span class="token punctuation">[</span><span class="token string">'DIVIDENTBT'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>float<span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">'DIVIDENTBT'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        # 计算相对于目前股份而言的分红额度
        df<span class="token punctuation">[</span><span class="token string">'DIVIDENTBT'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'DIVIDENTBT'</span><span class="token punctuation">]</span> <span class="token operator">*</span> df<span class="token punctuation">[</span><span class="token string">'CAP_RATIO'</span><span class="token punctuation">]</span>
        df <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'SYMBOL'</span><span class="token punctuation">,</span><span class="token string">'DECLAREDATE'</span><span class="token punctuation">,</span><span class="token string">'DISTRIBUTIONBASESHARES'</span><span class="token punctuation">,</span><span class="token string">'capitalization'</span><span class="token punctuation">,</span><span class="token string">'CAP_RATIO'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        
        #接下来这一步是考虑多次分红的股票，因此需要累加股票的多次分红
        df <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">groupby</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        #得到当前股价
        Price<span class="token operator">=</span><span class="token function">history</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> unit<span class="token operator">=</span><span class="token string">'1d'</span><span class="token punctuation">,</span> field<span class="token operator">=</span><span class="token string">'close'</span><span class="token punctuation">,</span> security_list<span class="token operator">=</span><span class="token function">list</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span> df<span class="token operator">=</span>True<span class="token punctuation">,</span> skip_paused<span class="token operator">=</span>False<span class="token punctuation">,</span> fq<span class="token operator">=</span><span class="token string">'pre'</span><span class="token punctuation">)</span>
        Price<span class="token operator">=</span>Price<span class="token punctuation">.</span>T
        
        df<span class="token punctuation">[</span><span class="token string">'pre_close'</span><span class="token punctuation">]</span><span class="token operator">=</span>Price
    
        #计算股息率 <span class="token operator">=</span> 股息<span class="token operator">/</span>股票价格，<span class="token operator">*</span> <span class="token number">10</span> 是因为取到的是每 <span class="token number">10</span> 股分红
        df<span class="token punctuation">[</span><span class="token string">'divpercent'</span><span class="token punctuation">]</span><span class="token operator">=</span>df<span class="token punctuation">[</span><span class="token string">'DIVIDENTBT'</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'pre_close'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span>
        
        df<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>index<span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> df

    def <span class="token function">fun_calStockWeight_by_risk</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> confidencelevel<span class="token punctuation">,</span> stocklist<span class="token punctuation">)</span><span class="token punctuation">:</span>
        
        def <span class="token function">__fun_calstock_risk_ES</span><span class="token punctuation">(</span>stock<span class="token punctuation">,</span> lag<span class="token punctuation">,</span> confidencelevel<span class="token punctuation">)</span><span class="token punctuation">:</span>
            hStocks <span class="token operator">=</span> <span class="token function">history</span><span class="token punctuation">(</span>lag<span class="token punctuation">,</span> <span class="token string">'1d'</span><span class="token punctuation">,</span> <span class="token string">'close'</span><span class="token punctuation">,</span> stock<span class="token punctuation">,</span> df<span class="token operator">=</span>True<span class="token punctuation">)</span>
            dailyReturns <span class="token operator">=</span> hStocks<span class="token punctuation">.</span><span class="token function">resample</span><span class="token punctuation">(</span><span class="token string">'D'</span><span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'last'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pct_change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fillna</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> method<span class="token operator">=</span>None<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values
            <span class="token keyword">if</span> confidencelevel   <span class="token operator">==</span> <span class="token number">1.96</span><span class="token punctuation">:</span>
                a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">0.95</span><span class="token punctuation">)</span>
            elif confidencelevel <span class="token operator">==</span> <span class="token number">2.06</span><span class="token punctuation">:</span>
                a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">0.96</span><span class="token punctuation">)</span>
            elif confidencelevel <span class="token operator">==</span> <span class="token number">2.18</span><span class="token punctuation">:</span>
                a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">0.97</span><span class="token punctuation">)</span>
            elif confidencelevel <span class="token operator">==</span> <span class="token number">2.34</span><span class="token punctuation">:</span>
                a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">0.98</span><span class="token punctuation">)</span>
            elif confidencelevel <span class="token operator">==</span> <span class="token number">2.58</span><span class="token punctuation">:</span>
                a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">0.99</span><span class="token punctuation">)</span>
            elif confidencelevel <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">:</span>
                a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">0.99999</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">0.95</span><span class="token punctuation">)</span>
            
            dailyReturns_sort <span class="token operator">=</span>  <span class="token function">sorted</span><span class="token punctuation">(</span>dailyReturns<span class="token punctuation">)</span>
    
            count <span class="token operator">=</span> <span class="token number">0</span>
            sum_value <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>dailyReturns_sort<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span>lag <span class="token operator">*</span> a<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    sum_value <span class="token operator">+</span><span class="token operator">=</span> dailyReturns_sort<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                    count <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span>
            <span class="token keyword">if</span> count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                ES <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                ES <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>sum_value <span class="token operator">/</span> <span class="token punctuation">(</span>lag <span class="token operator">*</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
            <span class="token keyword">if</span> <span class="token function">isnan</span><span class="token punctuation">(</span>ES<span class="token punctuation">)</span><span class="token punctuation">:</span>
                ES <span class="token operator">=</span> <span class="token number">0</span>

            <span class="token keyword">return</span> ES

        def <span class="token function">__fun_calstock_risk_VaR</span><span class="token punctuation">(</span>stock<span class="token punctuation">)</span><span class="token punctuation">:</span>
            hStocks <span class="token operator">=</span> <span class="token function">history</span><span class="token punctuation">(</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token string">'1d'</span><span class="token punctuation">,</span> <span class="token string">'close'</span><span class="token punctuation">,</span> stock<span class="token punctuation">,</span> df<span class="token operator">=</span>True<span class="token punctuation">)</span>
            dailyReturns <span class="token operator">=</span> hStocks<span class="token punctuation">.</span><span class="token function">resample</span><span class="token punctuation">(</span><span class="token string">'D'</span><span class="token punctuation">,</span>how<span class="token operator">=</span><span class="token string">'last'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pct_change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fillna</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> method<span class="token operator">=</span>None<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values
            VaR <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">2.58</span> <span class="token operator">*</span> np<span class="token punctuation">.</span><span class="token function">std</span><span class="token punctuation">(</span>dailyReturns<span class="token punctuation">)</span>

            <span class="token keyword">return</span> VaR
            
        __risk <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

        stock_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> stock <span class="token keyword">in</span> stocklist<span class="token punctuation">:</span>
            curRisk <span class="token operator">=</span> <span class="token function">__fun_calstock_risk_ES</span><span class="token punctuation">(</span>stock<span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> confidencelevel<span class="token punctuation">)</span>

            <span class="token keyword">if</span> curRisk <span class="token operator">&lt;</span><span class="token operator">&gt;</span> <span class="token number">0.0</span><span class="token punctuation">:</span>
                __risk<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">=</span> curRisk

        __position <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> stock <span class="token keyword">in</span> __risk<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            __position<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> __risk<span class="token punctuation">[</span>stock<span class="token punctuation">]</span>

        total_position <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> stock <span class="token keyword">in</span> __position<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            total_position <span class="token operator">+</span><span class="token operator">=</span> __position<span class="token punctuation">[</span>stock<span class="token punctuation">]</span>

        __ratio <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> stock <span class="token keyword">in</span> __position<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            tmpRatio <span class="token operator">=</span> __position<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">/</span> total_position
            <span class="token keyword">if</span> <span class="token function">isnan</span><span class="token punctuation">(</span>tmpRatio<span class="token punctuation">)</span><span class="token punctuation">:</span>
                tmpRatio <span class="token operator">=</span> <span class="token number">0</span>
            __ratio<span class="token punctuation">[</span>stock<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span>tmpRatio<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
    
        <span class="token keyword">return</span> __ratio

    def <span class="token function">fun_tradeBond</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> stock<span class="token punctuation">,</span> Value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        hStocks <span class="token operator">=</span> <span class="token function">history</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'1d'</span><span class="token punctuation">,</span> <span class="token string">'close'</span><span class="token punctuation">,</span> stock<span class="token punctuation">,</span> df<span class="token operator">=</span>False<span class="token punctuation">)</span>
        curPrice <span class="token operator">=</span> hStocks<span class="token punctuation">[</span>stock<span class="token punctuation">]</span>
        curValue <span class="token operator">=</span> <span class="token function">float</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>portfolio<span class="token punctuation">.</span>positions<span class="token punctuation">[</span>stock<span class="token punctuation">]</span><span class="token punctuation">.</span>total_amount <span class="token operator">*</span> curPrice<span class="token punctuation">)</span>
        deltaValue <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>Value <span class="token operator">-</span> curValue<span class="token punctuation">)</span>
        <span class="token keyword">if</span> deltaValue <span class="token operator">&gt;</span> <span class="token punctuation">(</span>curPrice<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> Value <span class="token operator">&gt;</span> curValue<span class="token punctuation">:</span>
                cash <span class="token operator">=</span> context<span class="token punctuation">.</span>portfolio<span class="token punctuation">.</span>cash
                <span class="token keyword">if</span> cash <span class="token operator">&gt;</span> <span class="token punctuation">(</span>curPrice<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span><span class="token function">fun_trade</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> stock<span class="token punctuation">,</span> Value<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                # 如果是银华日利，多卖 <span class="token number">100</span> 股，避免个股买少了
                <span class="token keyword">if</span> stock <span class="token operator">==</span> <span class="token string">'511880.XSHG'</span><span class="token punctuation">:</span>
                    Value <span class="token operator">-</span><span class="token operator">=</span> curPrice<span class="token operator">*</span><span class="token number">100</span>
                self<span class="token punctuation">.</span><span class="token function">fun_trade</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> stock<span class="token punctuation">,</span> Value<span class="token punctuation">)</span>

    # 剔除上市时间较短的产品
    def <span class="token function">fun_delNewShare</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> equity<span class="token punctuation">,</span> deltaday<span class="token punctuation">)</span><span class="token punctuation">:</span>
        deltaDate <span class="token operator">=</span> context<span class="token punctuation">.</span>current_dt<span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> dt<span class="token punctuation">.</span><span class="token function">timedelta</span><span class="token punctuation">(</span>deltaday<span class="token punctuation">)</span>
    
        tmpList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> stock <span class="token keyword">in</span> equity<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token function">get_security_info</span><span class="token punctuation">(</span>stock<span class="token punctuation">)</span><span class="token punctuation">.</span>start_date <span class="token operator">&lt;</span> deltaDate<span class="token punctuation">:</span>
                tmpList<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>stock<span class="token punctuation">)</span>
    
        <span class="token keyword">return</span> tmpList

    def <span class="token function">unpaused</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> _stocklist<span class="token punctuation">)</span><span class="token punctuation">:</span>
        current_data <span class="token operator">=</span> <span class="token function">get_current_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>s <span class="token keyword">for</span> s <span class="token keyword">in</span> _stocklist <span class="token keyword">if</span> not current_data<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">.</span>paused<span class="token punctuation">]</span>

    def <span class="token function">fun_trade</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> stock<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span><span class="token function">fun_setCommission</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> stock<span class="token punctuation">)</span>
        <span class="token function">order_target_value</span><span class="token punctuation">(</span>stock<span class="token punctuation">,</span> value<span class="token punctuation">)</span>

    def <span class="token function">fun_setCommission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">,</span> stock<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> stock <span class="token keyword">in</span> context<span class="token punctuation">.</span>lowPEG_moneyfund<span class="token punctuation">:</span>
            <span class="token function">set_order_cost</span><span class="token punctuation">(</span><span class="token function">OrderCost</span><span class="token punctuation">(</span>open_tax<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> close_tax<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> open_commission<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> close_commission<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> close_today_commission<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> min_commission<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token string">'stock'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token function">set_order_cost</span><span class="token punctuation">(</span><span class="token function">OrderCost</span><span class="token punctuation">(</span>open_tax<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> close_tax<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span> open_commission<span class="token operator">=</span><span class="token number">0.0003</span><span class="token punctuation">,</span> close_commission<span class="token operator">=</span><span class="token number">0.0003</span><span class="token punctuation">,</span> close_today_commission<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> min_commission<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> type<span class="token operator">=</span><span class="token string">'stock'</span><span class="token punctuation">)</span>
</code></pre>
</div><div class="article-navigation"><span class="prev">上一篇：<a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318054">网格交易</a></span><span class="next">下一篇：<a href="https://www.kancloud.cn/hanglei888/lianghuajiaocheng2/2318056">股指期货对冲策略</a></span></div><div class="article-foot"></div></div></div></div></div></div>
<script type="application/payload+json">
    {
        "config":{"plugins":["highlight","tex"],"id":494767,"title":"\u91cf\u5316\u6559\u7a0b1.02","description":"\u589e\u52a0\u4e86\u79d1\u521b\u677f\u533b\u836f\u533b\u7597\u7b56\u7565","cover":"https:\/\/cover.kancloud.cn\/hanglei888\/lianghuajiaocheng2!middle","author":{"name":"hanglei888","email":"312868755@qq.com","url":"https:\/\/www.kancloud.cn\/@hanglei888"}},
        "options":{"book":{"id":494767,"title":"\u91cf\u5316\u6559\u7a0b1.02","namespace":"hanglei888","name":"lianghuajiaocheng2","price":0,"cover":"https:\/\/cover.kancloud.cn\/hanglei888\/lianghuajiaocheng2","middle_cover":"https:\/\/cover.kancloud.cn\/hanglei888\/lianghuajiaocheng2!middle","small_cover":"https:\/\/cover.kancloud.cn\/hanglei888\/lianghuajiaocheng2!small"},"plugins":{"host":"plugins.kancloud.cn","scheme":"https"},"web":{"host":"www.kancloud.cn","scheme":"https"},"environment":"reader","base":"\/hanglei888\/lianghuajiaocheng2\/content","entry":"\/hanglei888\/lianghuajiaocheng2"},
        "style": "",
        "article":null,
        "summary":[{"id":2318041,"pid":0,"name":"\u5bfc\u8bed.md","title":"\u5bfc\u8bed","is_probation":0,"ref":"\u5bfc\u8bed.md","path":"2318041","index":0},{"id":2318042,"pid":0,"name":"\u7b2c\u4e00\u7ae0 \u521d\u8bc6\u91cf\u5316\u4ea4\u6613.md","title":"\u7b2c\u4e00\u7ae0 \u521d\u8bc6\u91cf\u5316\u4ea4\u6613","is_probation":0,"ref":"\u7b2c\u4e00\u7ae0 \u521d\u8bc6\u91cf\u5316\u4ea4\u6613.md","path":"2318042","index":1},{"id":2318043,"pid":0,"name":"\u7b2c\u4e8c\u7ae0 \u91cf\u5316\u7b56\u7565\u7684\u57fa\u672c\u6846\u67b6.md","title":"\u7b2c\u4e8c\u7ae0 \u91cf\u5316\u7b56\u7565\u7684\u57fa\u672c\u6846\u67b6","is_probation":0,"ref":"\u7b2c\u4e8c\u7ae0 \u91cf\u5316\u7b56\u7565\u7684\u57fa\u672c\u6846\u67b6.md","path":"2318043","index":2},{"id":2318044,"pid":0,"name":"\u7b2c\u4e09\u7ae0 \u6211\u7684\u57fa\u672c\u6846\u67b6.md","title":"\u7b2c\u4e09\u7ae0 \u6211\u7684\u57fa\u672c\u6846\u67b6","is_probation":0,"ref":"\u7b2c\u4e09\u7ae0 \u6211\u7684\u57fa\u672c\u6846\u67b6.md","path":"2318044","index":3,"articles":[{"id":2318045,"pid":2318044,"name":"\u6211\u7684\u4ee3\u7801\u6846\u67b6\uff08\u9644\u6e90\u4ee3\u7801\uff09.md","title":"\u6211\u7684\u4ee3\u7801\u6846\u67b6\uff08\u9644\u6e90\u4ee3\u7801\uff09","is_probation":0,"ref":"\u6211\u7684\u4ee3\u7801\u6846\u67b6\uff08\u9644\u6e90\u4ee3\u7801\uff09.md","path":"2318045","index":4},{"id":2318046,"pid":2318044,"name":"\u600e\u4e48\u4f7f\u7528\u6211\u7684\u4ee3\u7801\u6846\u67b6.md","title":"\u600e\u4e48\u4f7f\u7528\u6211\u7684\u4ee3\u7801\u6846\u67b6","is_probation":0,"ref":"\u600e\u4e48\u4f7f\u7528\u6211\u7684\u4ee3\u7801\u6846\u67b6.md","path":"2318046","index":5},{"id":2318047,"pid":2318044,"name":"\u4e09\u4efd\u91cd\u8981\u7684\u4f5c\u4e1a.md","title":"\u4e09\u4efd\u91cd\u8981\u7684\u4f5c\u4e1a","is_probation":0,"ref":"\u4e09\u4efd\u91cd\u8981\u7684\u4f5c\u4e1a.md","path":"2318047","index":6},{"id":2318048,"pid":2318044,"name":"\u4ee3\u7801\u6846\u67b6\u56fe\u89e3\uff08\u9644\u5f55\uff09.md","title":"\u4ee3\u7801\u6846\u67b6\u56fe\u89e3\uff08\u9644\u5f55\uff09","is_probation":0,"ref":"\u4ee3\u7801\u6846\u67b6\u56fe\u89e3\uff08\u9644\u5f55\uff09.md","path":"2318048","index":7},{"id":2318049,"pid":2318044,"name":"\u4ee3\u7801\u6bb5\u8be6\u89e3\uff08\u9644\u5f55\uff09.md","title":"\u4ee3\u7801\u6bb5\u8be6\u89e3\uff08\u9644\u5f55\uff09","is_probation":0,"ref":"\u4ee3\u7801\u6bb5\u8be6\u89e3\uff08\u9644\u5f55\uff09.md","path":"2318049","index":8}]},{"id":2318050,"pid":0,"name":"\u7b2c\u56db\u7ae0 \u83b7\u53d6\u5178\u578b\u5e38\u7528\u6570\u636e.md","title":"\u7b2c\u56db\u7ae0 \u83b7\u53d6\u5178\u578b\u5e38\u7528\u6570\u636e","is_probation":0,"ref":"\u7b2c\u56db\u7ae0 \u83b7\u53d6\u5178\u578b\u5e38\u7528\u6570\u636e.md","path":"2318050","index":9},{"id":2318051,"pid":0,"name":"\u7b2c\u4e94\u7ae0 \u7b56\u7565\u8bc4\u4ef7\u4e0e\u5efa\u7acb\u6a21\u62df.md","title":"\u7b2c\u4e94\u7ae0 \u7b56\u7565\u8bc4\u4ef7\u4e0e\u5efa\u7acb\u6a21\u62df","is_probation":0,"ref":"\u7b2c\u4e94\u7ae0 \u7b56\u7565\u8bc4\u4ef7\u4e0e\u5efa\u7acb\u6a21\u62df.md","path":"2318051","index":10},{"id":2318052,"pid":0,"name":"\u7b2c\u516d\u7ae0 \u7ecf\u5178\u7b56\u7565\u5b66\u4e60.md","title":"\u7b2c\u516d\u7ae0 \u7ecf\u5178\u7b56\u7565\u5b66\u4e60","is_probation":0,"ref":"\u7b2c\u516d\u7ae0 \u7ecf\u5178\u7b56\u7565\u5b66\u4e60.md","path":"2318052","index":11,"articles":[{"id":2318053,"pid":2318052,"name":"\u57fa\u672c\u9762\u7b56\u7565.md","title":"RSRS\u62e9\u65f6+\u57fa\u672c\u9762\u9009\u80a1","is_probation":0,"ref":"\u57fa\u672c\u9762\u7b56\u7565.md","path":"2318053","index":12},{"id":2318054,"pid":2318052,"name":"\u7f51\u683c\u4ea4\u6613.md","title":"\u7f51\u683c\u4ea4\u6613","is_probation":0,"ref":"\u7f51\u683c\u4ea4\u6613.md","path":"2318054","index":13},{"id":2318055,"pid":2318052,"name":"\u5f7c\u5f97\u6797\u5947PEG\u7b56\u7565.md","title":"\u5f7c\u5f97\u6797\u5947PEG\u7b56\u7565","is_probation":0,"ref":"\u5f7c\u5f97\u6797\u5947PEG\u7b56\u7565.md","path":"2318055","index":14},{"id":2318056,"pid":2318052,"name":"\u80a1\u6307\u671f\u8d27\u5bf9\u51b2\u7b56\u7565.md","title":"\u80a1\u6307\u671f\u8d27\u5bf9\u51b2\u7b56\u7565","is_probation":0,"ref":"\u80a1\u6307\u671f\u8d27\u5bf9\u51b2\u7b56\u7565.md","path":"2318056","index":15},{"id":2318057,"pid":2318052,"name":"\u6da8\u505c\u56de\u8c03\u77ed\u7ebf\u7b56\u7565.md","title":"\u6da8\u505c\u56de\u8c03\u77ed\u7ebf\u7b56\u7565","is_probation":0,"ref":"\u6da8\u505c\u56de\u8c03\u77ed\u7ebf\u7b56\u7565.md","path":"2318057","index":16},{"id":2318058,"pid":2318052,"name":"\u51c0\u5229\u6da6\u65ad\u5c42\u7b56\u7565.md","title":"\u51c0\u5229\u6da6\u65ad\u5c42\u7b56\u7565","is_probation":0,"ref":"\u51c0\u5229\u6da6\u65ad\u5c42\u7b56\u7565.md","path":"2318058","index":17},{"id":2318059,"pid":2318052,"name":"\u8d8b\u52bf\u5f62\u6001\u7b56\u7565.md","title":"\u8d8b\u52bf\u5f62\u6001\u7b56\u7565","is_probation":0,"ref":"\u8d8b\u52bf\u5f62\u6001\u7b56\u7565.md","path":"2318059","index":18},{"id":2318060,"pid":2318052,"name":"\u533b\u836f\u80a1\u7b56\u7565.md","title":"\u533b\u836f\u80a1\u7b56\u7565","is_probation":0,"ref":"\u533b\u836f\u80a1\u7b56\u7565.md","path":"2318060","index":19},{"id":2318061,"pid":2318052,"name":"\u8d85\u8dcc\u6b21\u65b0\u80a1\u7b56\u7565.md","title":"\u8d85\u8dcc\u6b21\u65b0\u80a1\u7b56\u7565","is_probation":0,"ref":"\u8d85\u8dcc\u6b21\u65b0\u80a1\u7b56\u7565.md","path":"2318061","index":20},{"id":2318062,"pid":2318052,"name":"\u533b\u836f\u6d88\u8d39\u4f4e\u4f30\u9ad8\u589e\u957f\u7b56\u7565.md","title":"\u533b\u836f\u6d88\u8d39\u4f4e\u4f30\u9ad8\u589e\u957f\u7b56\u7565","is_probation":0,"ref":"\u533b\u836f\u6d88\u8d39\u4f4e\u4f30\u9ad8\u589e\u957f\u7b56\u7565.md","path":"2318062","index":21},{"id":2318063,"pid":2318052,"name":"ROA\u62e9\u65f6\u7b56\u7565.md","title":"ROA\u62e9\u65f6\u7b56\u7565","is_probation":0,"ref":"ROA\u62e9\u65f6\u7b56\u7565.md","path":"2318063","index":22},{"id":2318064,"pid":2318052,"name":"\u79d1\u521b\u677f\u533b\u7597\u533b\u836f\u80a1\u7b56\u7565.md","title":"\u79d1\u521b\u677f\u533b\u7597\u533b\u836f\u80a1\u7b56\u7565","is_probation":0,"ref":"\u79d1\u521b\u677f\u533b\u7597\u533b\u836f\u80a1\u7b56\u7565.md","path":"2318064","index":23},{"id":2425451,"pid":2318052,"name":"\u51c0\u5229\u6da6\u65ad\u5c42\u4fee\u6b63\u7248.md","title":"\u51c0\u5229\u6da6\u65ad\u5c42\u4fee\u6b63\u7248","is_probation":0,"ref":"\u51c0\u5229\u6da6\u65ad\u5c42\u4fee\u6b63\u7248.md","path":"2425451","index":24},{"id":2479237,"pid":2318052,"name":"\u52a8\u91cf\u7b80\u5355.md","title":"\u52a8\u91cf\u7b80\u5355","is_probation":0,"ref":"\u52a8\u91cf\u7b80\u5355.md","path":"2479237","index":25}]},{"id":2318065,"pid":0,"name":"\u7b2c\u4e03\u7ae0 python\u7f16\u7a0b.md","title":"\u7b2c\u4e03\u7ae0 python\u7f16\u7a0b","is_probation":0,"ref":"\u7b2c\u4e03\u7ae0 python\u7f16\u7a0b.md","path":"2318065","index":26,"articles":[{"id":2318066,"pid":2318065,"name":"python\u5b66\u4e60\u8d44\u6e90.md","title":"python\u5b66\u4e60\u8d44\u6e90","is_probation":0,"ref":"python\u5b66\u4e60\u8d44\u6e90.md","path":"2318066","index":27},{"id":2318067,"pid":2318065,"name":"python\u57fa\u7840\u805a\u5bbd\u7248.md","title":"python\u57fa\u7840\uff08\u5feb\u901f\u5b66\u4e60\uff09\u805a\u5bbd\u7248","is_probation":0,"ref":"python\u57fa\u7840\u805a\u5bbd\u7248.md","path":"2318067","index":28},{"id":2318068,"pid":2318065,"name":"python\u4f7f\u7528\u8bed\u53e5\u96c6\u5408\uff08\u805a\u5bbd\uff09.md","title":"python\u4f7f\u7528\u8bed\u53e5\u96c6\u5408\uff08\u805a\u5bbd\uff09","is_probation":0,"ref":"python\u4f7f\u7528\u8bed\u53e5\u96c6\u5408\uff08\u805a\u5bbd\uff09.md","path":"2318068","index":29},{"id":2318069,"pid":2318065,"name":"python\u7cfb\u7edf\u5b66\u4e60\u3010\u7b2c\u4e00\u8bfe\u3011.md","title":"python\u7cfb\u7edf\u5b66\u4e60\u3010\u7b2c\u4e00\u8bfe\u3011","is_probation":0,"ref":"python\u7cfb\u7edf\u5b66\u4e60\u3010\u7b2c\u4e00\u8bfe\u3011.md","path":"2318069","index":30},{"id":2318070,"pid":2318065,"name":"python\u7cfb\u7edf\u5b66\u4e60\u3010\u7b2c\u4e8c\u8bfe\u3011.md","title":"python\u7cfb\u7edf\u5b66\u4e60\u3010\u7b2c\u4e8c\u8bfe\u3011","is_probation":0,"ref":"python\u7cfb\u7edf\u5b66\u4e60\u3010\u7b2c\u4e8c\u8bfe\u3011.md","path":"2318070","index":31},{"id":2318071,"pid":2318065,"name":"python\u7cfb\u7edf\u5b66\u4e60\u3010\u7b2c\u4e09\u8bfe\u3011.md","title":"python\u7cfb\u7edf\u5b66\u4e60\u3010\u7b2c\u4e09\u8bfe\u3011","is_probation":0,"ref":"python\u7cfb\u7edf\u5b66\u4e60\u3010\u7b2c\u4e09\u8bfe\u3011.md","path":"2318071","index":32},{"id":2318072,"pid":2318065,"name":"python\u7cfb\u7edf\u5b66\u4e60\u7b2c\u56db\u8bfe.md","title":"python\u7cfb\u7edf\u5b66\u4e60\u3010\u7b2c\u56db\u8bfe\u3011","is_probation":0,"ref":"python\u7cfb\u7edf\u5b66\u4e60\u7b2c\u56db\u8bfe.md","path":"2318072","index":33},{"id":2318073,"pid":2318065,"name":"python\u7cfb\u7edf\u5b66\u4e60\u3010\u7b2c\u4e94\u8bfe\u3011.md","title":"python\u7cfb\u7edf\u5b66\u4e60\u3010\u7b2c\u4e94\u8bfe\u3011","is_probation":0,"ref":"python\u7cfb\u7edf\u5b66\u4e60\u3010\u7b2c\u4e94\u8bfe\u3011.md","path":"2318073","index":34},{"id":2318074,"pid":2318065,"name":"python\u7cfb\u7edf\u5b66\u4e60\u3010\u7b2c\u516d\u8bfe\u3011.md","title":"python\u7cfb\u7edf\u5b66\u4e60\u3010\u7b2c\u516d\u8bfe\u3011","is_probation":0,"ref":"python\u7cfb\u7edf\u5b66\u4e60\u3010\u7b2c\u516d\u8bfe\u3011.md","path":"2318074","index":35}]},{"id":2318075,"pid":0,"name":"\u7b2c\u516b\u7ae0\u5b9e\u76d8\u4ea4\u6613.md","title":"\u7b2c\u516b\u7ae0 \u5b9e\u76d8\u4ea4\u6613","is_probation":0,"ref":"\u7b2c\u516b\u7ae0\u5b9e\u76d8\u4ea4\u6613.md","path":"2318075","index":36}]
    }
</script>
<script type="text/javascript" src="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/reader.js"></script>
<script type="text/javascript">
        if (self === top) {
        kancloud.bootstrap();
    }
    </script>
    <!-- Google Analytics -->
    <script>
        window.ga = window.ga || function () {
            (ga.q = ga.q || []).push(arguments)
        };
        ga.l      = +new Date;
        ga('create', 'UA-85687835-1', 'auto', 'web');
        ga('set', 'transport', 'beacon');
        
                ga('web.send', 'pageview', {
            dimension1:494767
        });
        window.sendPageView = function (page, title) {
            ga('web.set', 'page', page);
            ga('web.set', 'title', title);
            ga('web.send', 'pageview', {
                dimension1: 494767
            });
        }
            </script>
    <script async="" src="./彼得林奇PEG策略 · 量化教程1.02 · 看云_files/analytics.js"></script>
    <!-- End Google Analytics -->


</body></html>